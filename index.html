<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
    <title>HR Training</title>
    
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.run/@google/genai"
        }
      }
    </script>

    <style>
        :root {
            --bg: #000000;
            --surface: #1c1c1e;
            --surface-hover: #2c2c2e;
            --primary: #ff6b00;
            --primary-hover: #e65c00;
            --text: #ffffff;
            --text-secondary: #8e8e93;
            --border: #38383a;
            --radius: 12px;
            --input-bg: #2c2c2e;
            --risk-low: #30d158;
            --risk-mod: #ff9f0a;
            --risk-high: #ff453a;
            --nav-height: 65px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.5;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* Estilo visual espec√≠fico solicitado */
        b, strong { color: var(--primary); }

        .app-view {
            padding: 20px 20px calc(var(--nav-height) + 40px) 20px;
            max-width: 600px;
            margin: 0 auto;
            box-sizing: border-box;
            display: none;
            animation: fadeIn 0.2s ease-out;
        }
        .app-view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header-title { 
            color: var(--primary); 
            font-size: 28px; 
            font-weight: 800;
            margin: 0 0 20px 0;
            letter-spacing: -1px;
            cursor: pointer;
            display: inline-block;
        }

        h2 { font-size: 22px; margin: 32px 0 16px 0; font-weight: 700; }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: var(--nav-height);
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 0.5px solid var(--border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.2s;
        }

        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 22px; }

        /* Search & Filter */
        .search-wrapper { position: sticky; top: 10px; z-index: 100; margin-bottom: 20px; }
        input#search {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border-radius: 10px;
            border: none;
            background: var(--surface);
            color: var(--text);
            font-size: 17px;
            box-sizing: border-box;
            outline: none;
        }

        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        .clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #48484a;
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .clear-btn.visible { display: flex; }

        .filter-toggle {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--surface);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 16px;
            border: none;
        }

        .filter-badge { background: var(--primary); width: 6px; height: 6px; border-radius: 50%; display: none; }
        .filter-badge.active { display: block; }

        #filter-panel {
            background: var(--surface);
            padding: 16px;
            border-radius: var(--radius);
            margin-bottom: 24px;
            display: none;
            flex-direction: column;
            gap: 16px;
        }
        #filter-panel.visible { display: flex; }
        .filter-group select { width: 100%; background: var(--input-bg); color: white; padding: 10px; border-radius: 8px; border: 1px solid var(--border); font-size: 14px; }

        /* Cards */
        .card { background: var(--surface); padding: 18px; border-radius: 16px; margin-bottom: 16px; }
        .exercise-title { font-weight: 700; font-size: 18px; margin-bottom: 8px; }
        .badges { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .badge { font-size: 11px; padding: 4px 10px; border-radius: 8px; background: #2c2c2e; color: var(--text-secondary); }
        .badge.accent { color: var(--primary); background: rgba(255, 107, 0, 0.1); }
        .badge.risk-Bajo { color: var(--risk-low); }
        .badge.risk-Mod { color: var(--risk-mod); }
        .badge.risk-Alto { color: var(--risk-high); }

        .exercise-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        button { border-radius: 10px; padding: 12px; font-weight: 600; font-size: 15px; border: none; cursor: pointer; transition: opacity 0.2s; }
        button:active { opacity: 0.6; }
        button.primary { background: var(--primary); color: white; }
        button.secondary { background: var(--input-bg); color: var(--text); border: 1px solid var(--border); }

        /* History */
        .history-card { cursor: pointer; border-left: 3px solid var(--primary); }
        .history-date { font-weight: 700; color: var(--primary); font-size: 14px; margin-bottom: 4px; }
        .history-summary { color: var(--text-secondary); font-size: 13px; }
        .history-details { display: none; margin-top: 16px; border-top: 0.5px solid var(--border); padding-top: 16px; }
        .history-details.visible { display: block; }
        .hist-ex-item { margin-bottom: 12px; }
        .hist-ex-name { font-weight: 600; font-size: 15px; }
        .hist-set-badge { display: inline-block; background: var(--input-bg); padding: 2px 8px; border-radius: 4px; font-size: 12px; margin: 4px 4px 0 0; font-family: monospace; }

        /* Modal Details */
        #info-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000; display: none; flex-direction: column; box-sizing: border-box; }
        #info-modal.visible { display: flex; }
        .modal-header { padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 0.5px solid var(--border); }
        .modal-title { font-weight: 800; font-size: 18px; }
        .modal-body { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 80px; }

        .cue-box { background: rgba(255, 107, 0, 0.1); border: 1px solid rgba(255, 107, 0, 0.2); padding: 16px; border-radius: 12px; margin-bottom: 20px; font-style: italic; }
        .detail-label { display: block; color: var(--primary); font-weight: 700; font-size: 12px; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px; }
        .detail-text { margin-bottom: 20px; color: var(--text-secondary); font-size: 15px; }

        .loader-container { padding: 40px; text-align: center; color: var(--text-secondary); }
        .loader { border: 3px solid #333; border-top: 3px solid var(--primary); border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .set-row { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .set-input-group { flex: 1; }
        .set-input-group label { font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px; }
        .set-input-group input { width: 100%; background: var(--input-bg); border: 1px solid var(--border); color: white; padding: 8px; border-radius: 6px; box-sizing: border-box; }

    </style>
</head>
<body>

    <!-- VISTA: EJERCICIOS -->
    <div id="view-exercises" class="app-view active">
        <h1 class="header-title" onclick="window.location.reload()">HR Training</h1>
        
        <div class="search-wrapper" id="search-container">
            <span class="search-icon">üîç</span>
            <input id="search" placeholder="M√∫sculo, patr√≥n o nombre..." autocomplete="off" oninput="window.handleSearchInput()"/>
            <button id="clear-search" class="clear-btn" onclick="window.clearSearch()">‚úï</button>
        </div>

        <button class="filter-toggle" onclick="window.toggleFilterPanel()">
            üîç Filtros <span id="filter-badge" class="filter-badge"></span>
        </button>

        <div id="filter-panel">
            <div class="filter-group"><select id="filter-category" class="filter-select"><option value="">Categor√≠a</option></select></div>
            <div class="filter-group"><select id="filter-pattern" class="filter-select"><option value="">Patr√≥n</option></select></div>
            <div class="filter-group"><select id="filter-muscle" class="filter-select"><option value="">M√∫sculo</option></select></div>
            <div class="filter-group"><select id="filter-risk" class="filter-select"><option value="">Riesgo</option></select></div>
            <div class="filter-group"><select id="filter-equipment" class="filter-select"><option value="">Equipo</option></select></div>
            <button class="secondary" onclick="window.resetFilters()" style="margin-top:8px;">Limpiar Filtros</button>
        </div>

        <div id="exercise-list"></div>
    </div>

    <!-- VISTA: SESI√ìN ACTUAL -->
    <div id="view-session" class="app-view">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1 style="margin:0">Sesi√≥n</h1>
            <button class="primary" onclick="window.saveSession()" style="padding: 8px 16px;">Guardar</button>
        </div>
        <div id="session"></div>
    </div>

    <!-- VISTA: HISTORIAL -->
    <div id="view-history" class="app-view">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1 style="margin:0">Historial</h1>
            <div style="display:flex; gap:8px;">
                <button class="secondary" style="padding: 6px 12px; font-size: 13px;" onclick="window.exportData()">Exportar</button>
                <button class="secondary" style="padding: 6px 12px; font-size: 13px;" onclick="document.getElementById('import-file').click()">Importar</button>
            </div>
        </div>
        <input type="file" id="import-file" style="display:none" onchange="window.importData(event)"/>
        <div id="history"></div>
    </div>

    <!-- VISTA: CONFIGURACI√ìN -->
    <div id="view-config" class="app-view">
        <h1>Ajustes</h1>
        
        <div class="card">
            <h3>ü§ñ Inteligencia Artificial</h3>
            <div style="color:var(--text-secondary); font-size:13px; margin-bottom:16px;">
                Para an√°lisis t√©cnico avanzado e im√°genes, usa tu propia <b>Google Gemini API Key</b> (gratuita).
                <br/><br/>
                <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color:var(--primary); font-weight:700">Obtener API Key gratis ‚Üí</a>
            </div>

            <div style="margin-bottom: 16px;">
                <label style="display:block; margin-bottom:8px; font-size:12px">Tu API Key</label>
                <input type="password" id="user-api-key-input" placeholder="Pegar clave aqu√≠..." style="width:100%; padding:12px; background:var(--input-bg); border:1px solid var(--border); border-radius:8px; color:white; box-sizing:border-box" />
            </div>

            <button class="primary" onclick="window.saveUserApiKey()" style="width: 100%; margin-bottom: 12px;">Guardar Clave</button>
            <button class="secondary" onclick="window.removeUserApiKey()" style="width: 100%; color: var(--risk-high);">Borrar Clave</button>
            
            <div id="apikey-status" style="margin-top:16px; font-size:12px; text-align:center"></div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="window.switchTab('exercises', this)">
            <span class="nav-icon">üèãÔ∏è</span>
            <span>Ejercicios</span>
        </div>
        <div class="nav-item" onclick="window.switchTab('session', this)">
            <span class="nav-icon">üìù</span>
            <span>Sesi√≥n</span>
        </div>
        <div class="nav-item" onclick="window.switchTab('history', this)">
            <span class="nav-icon">üìú</span>
            <span>Historial</span>
        </div>
        <div class="nav-item" onclick="window.switchTab('config', this)">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>Ajustes</span>
        </div>
    </nav>

    <!-- Modal Details -->
    <div id="info-modal">
        <div class="modal-header">
            <div class="modal-title" id="info-modal-title">Detalle</div>
            <button onclick="window.closeInfoModal()" style="background:none; color:var(--primary); font-size:24px; padding:0">‚úï</button>
        </div>
        <div class="modal-body">
            <div id="static-info-container"></div>
            <h2 style="font-size: 16px; border-bottom: 0.5px solid var(--border); padding-bottom: 8px;">Visualizaci√≥n</h2>
            <div id="ai-images-container"></div>
            <h2 id="ai-text-header" style="font-size: 16px; border-bottom: 0.5px solid var(--border); padding-bottom: 8px; margin-top:30px">An√°lisis IA</h2>
            <div id="ai-text-container"></div>
        </div>
    </div>

<script type="module">
// Gesti√≥n de Vistas
window.switchTab = function(tabName, el) {
    document.querySelectorAll('.app-view').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById('view-' + tabName).classList.add('active');
    if(el) el.classList.add('active');
    window.scrollTo(0,0);
    if(tabName === 'session') window.renderSession();
    if(tabName === 'history') window.renderHistory();
    if(tabName === 'config') window.updateApiKeyUI();
};

window.updateApiKeyUI = function() {
    const status = document.getElementById('apikey-status');
    const input = document.getElementById('user-api-key-input');
    const savedKey = localStorage.getItem('hr_training_gemini_key');
    if (savedKey) {
        input.value = savedKey;
        status.innerHTML = '<span style="color:var(--risk-low)">‚óè</span> Clave activa';
    } else {
        input.value = '';
        status.innerHTML = '<span style="color:var(--text-secondary)">‚óè</span> Sin configurar';
    }
};

let aiClient = null;
const textAnalysisCache = {};
const LS_KEY = 'hr_training_gemini_key';

window.saveUserApiKey = function() {
    const input = document.getElementById('user-api-key-input');
    const key = input.value.trim();
    if (!key) return alert('Ingresa una clave v√°lida');
    localStorage.setItem(LS_KEY, key);
    aiClient = null;
    for (let m in textAnalysisCache) delete textAnalysisCache[m];
    window.updateApiKeyUI();
    alert('Guardada correctamente');
}

window.removeUserApiKey = function() {
    if(confirm('¬øBorrar API Key?')) {
        localStorage.removeItem(LS_KEY);
        aiClient = null;
        for (let m in textAnalysisCache) delete textAnalysisCache[m];
        window.updateApiKeyUI();
        alert('Borrada');
    }
}

async function getGenAI() {
    if (aiClient) return aiClient;
    try {
        const { GoogleGenAI } = await import("@google/genai");
        let apiKey = localStorage.getItem(LS_KEY);
        if (!apiKey) {
            try { if (typeof process !== 'undefined' && process.env && process.env.API_KEY) apiKey = process.env.API_KEY; } catch (e) {}
        }
        if (!apiKey) return null;
        aiClient = new GoogleGenAI({ apiKey: apiKey });
        return aiClient;
    } catch (error) { return null; }
}

const RAW_DATA = [
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Pedaleo continuo", musc: ["Cu√°driceps", "Cardio"], risk: "Bajo", cue: "C√≠rculos perfectos", instr: "Mant√©n un ritmo constante moderado. Enf√≥cate en la t√©cnica del pedaleo redondo, empujando y tirando.", tips: ["Sill√≠n a altura de cresta il√≠aca", "Codos semiflexionados", "Rodillas alineadas con pies"], errors: ["Sill√≠n muy bajo (rodillas muy dobladas)", "Rebotar en el asiento"] },
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Zona 2", musc: ["Cardio"], risk: "Bajo", cue: "Respiraci√≥n nasal", instr: "Pedalea a una intensidad donde puedas mantener una conversaci√≥n fluida (60-70% FCM).", tips: ["Mant√©n conversaci√≥n fluida", "Esfuerzo constante 6/10", "Relaja hombros"], errors: ["Ir demasiado r√°pido", "Tensi√≥n en trapecios"] },
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Tempo", musc: ["Piernas", "Cardio"], risk: "Mod", cue: "Ritmo inc√≥modo", instr: "Sost√©n un ritmo 'c√≥modamente duro' (zona 3-4) durante un tiempo prolongado sin descanso.", tips: ["Cadencia 80-90 RPM", "Torso quieto", "Respiraci√≥n r√≠tmica"], errors: ["Empezar muy fuerte y decaer", "Bajar la cadencia"] },
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Intervalos HIIT", musc: ["Anaer√≥bico"], risk: "Alto", cue: "Explota 100%", instr: "Alterna periodos de esfuerzo m√°ximo (sprints) con descansos activos suaves.", tips: ["Sube resistencia antes de acelerar", "Recupera suavemente", "M√°xima intensidad real"], errors: ["Pedalear r√°pido sin resistencia", "Parar de golpe"] },
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Sprint sentado", musc: ["Potencia"], risk: "Mod", cue: "Acelera sin rebotar", instr: "Aumenta la resistencia y la velocidad al m√°ximo sin levantarte del sill√≠n.", tips: ["Core firme", "Manos ligeras en manillar", "Cadera anclada"], errors: ["Saltar en el sill√≠n", "Crispar cuello"] },
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Sprint de pie", musc: ["Gl√∫teos"], risk: "Alto", cue: "Usa tu peso", instr: "Lev√°ntate y usa tu peso corporal para empujar los pedales con m√°xima potencia.", tips: ["Cuerpo adelantado", "Balanceo lateral controlado", "Brazos traccionan"], errors: ["Peso muy atr√°s", "Codos bloqueados"] },
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Cadencia alta", musc: ["Coordinaci√≥n"], risk: "Bajo", cue: "Pies r√°pidos", instr: "Baja la resistencia y pedalea lo m√°s r√°pido posible (>100 RPM) sin rebotar.", tips: ["+100 RPM", "Caderas quietas", "Movimiento fluido"], errors: ["Rebotar excesivamente", "Resistencia en cero (flotar)"] },
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Cadencia baja fuerza", musc: ["Fuerza"], risk: "Mod", cue: "Empuja y tira", instr: "Alta resistencia, baja velocidad (60 RPM). Simula subir una cuesta empinada sentado.", tips: ["60 RPM con mucha carga", "Torso est√°tico", "Empuje desde tal√≥n"], errors: ["Tirar de lumbares", "Rodillas hacia dentro"] },
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Climb seated", musc: ["Gl√∫teos"], risk: "Bajo", cue: "Talones abajo", instr: "Simula escalada sentado. Manos en la parte superior del manillar, cadera atr√°s.", tips: ["Si√©ntate atr√°s en el sill√≠n", "Manos relajadas", "Foco en gl√∫teo"], errors: ["Adelantarse en el sill√≠n", "Hombros tensos"] },
    { cat: "Cardio", sub: "Bicicleta", name: "Bicicleta - Climb standing", musc: ["Full Body"], risk: "Mod", cue: "Danza con la bici", instr: "Escalada de pie. Balancea la bici suavemente de lado a lado con cada pedalada.", tips: ["Ritmo acompasado", "Mirada al frente", "Peso sobre pedales"], errors: ["Apoyar todo el peso en brazos", "Cadera pegada al manillar"] },
    { cat: "Cardio", sub: "Caminadora", name: "Caminadora - Plana", musc: ["Cardio"], risk: "Bajo", cue: "Postura alta", instr: "Caminata normal a ritmo sostenido. Mant√©n buena postura.", tips: ["Brazos a 90¬∫ balance√°ndose", "Pisada natural tal√≥n-punta", "Mirada al frente"], errors: ["Agarrarse de los rieles", "Mirar los pies"] },
    { cat: "Cardio", sub: "Caminadora", name: "Caminadora - Inclinada", musc: ["Gl√∫teos"], risk: "Bajo", cue: "Sin manos", instr: "Eleva la inclinaci√≥n (10-15%) y camina sin sostenerte.", tips: ["Inclina torso levemente desde tobillos", "Empuja con tal√≥n", "Zancada normal"], errors: ["Colgarse de la consola (anula el trabajo)", "Pasos muy largos"] },
    { cat: "Cardio", sub: "Caminadora", name: "Caminadora - Zona 2", musc: ["Cardio"], risk: "Bajo", cue: "Suave y constante", instr: "Caminata o trote muy suave donde puedas hablar sin jadear.", tips: ["Ritmo conversacional", "Respiraci√≥n nasal controlada", "Hombros relajados"], errors: ["Subestimar la fatiga acumulada", "Acelerar por aburrimiento"] },
    { cat: "Cardio", sub: "Caminadora", name: "Caminadora - NEAT", musc: ["Metabolismo"], risk: "Bajo", cue: "Movimiento vida", instr: "Caminata muy lenta para mantenerse activo mientras haces otra cosa (ej. leer).", tips: ["Sin sudar", "Larga duraci√≥n", "Postura relajada"], errors: ["Mala postura al leer/ver m√≥vil", "Calzado inadecuado"] },
    { cat: "Cardio", sub: "Caminadora", name: "Caminadora - Inclinada Tempo", musc: ["Piernas"], risk: "Mod", cue: "Marcha fuerte", instr: "Caminata con pendiente a ritmo vigoroso, casi al l√≠mite de tener que correr.", tips: ["Brazos activos ayudan", "Zancada potente", "Core activo"], errors: ["Empezar a trotar", "Hiperextender rodilla al impactar"] },
    { cat: "Cardio", sub: "Caminadora", name: "Trote ligero", musc: ["Cardio"], risk: "Bajo", cue: "Pisada silenciosa", instr: "Carrera suave. El impacto debe ser m√≠nimo y el ruido de los pasos bajo.", tips: ["Cadencia alta (pasos cortos)", "Aterriza bajo el cuerpo", "Cuerpo erguido"], errors: ["Talonear excesivamente", "Saltar verticalmente (bouncing)"] },
    { cat: "Cardio", sub: "Caminadora", name: "Intervalos Caminata-Trote", musc: ["Cardio"], risk: "Bajo", cue: "Recupera aire", instr: "Alterna 1-2 min de trote con 1-2 min de caminata para recuperar.", tips: ["Camina r√°pido en descanso", "Trote suave en trabajo", "Transiciones suaves"], errors: ["Parar totalmente en el descanso", "Trote demasiado r√°pido"] },
    { cat: "Cardio", sub: "Remo", name: "Remo continuo", musc: ["Espalda", "Piernas"], risk: "Bajo", cue: "Piernas-Cuerpo-Brazos", instr: "Secuencia clave: Empuja piernas, inclina cuerpo, jala brazos. Vuelve al rev√©s.", tips: ["Secuencia 1-2-3", "Talones pegados al empujar", "Cadena recta"], errors: ["Jalar brazos antes de estirar piernas", "Encorvar espalda"] },
    { cat: "Cardio", sub: "Remo", name: "Remo Zona 2", musc: ["Aer√≥bico"], risk: "Bajo", cue: "Fluidez", instr: "Remo a ritmo constante y sostenible. Enf√≥cate en la t√©cnica perfecta.", tips: ["Ritmo constante", "Ratio 1:1 o 1:2", "Respiraci√≥n r√≠tmica"], errors: ["Variar intensidad", "Perder t√©cnica por fatiga"] },
    { cat: "Cardio", sub: "Remo", name: "Remo por cadencia", musc: ["Coordinaci√≥n"], risk: "Bajo", cue: "Controla el retorno", instr: "Mant√©n un n√∫mero de remadas por minuto (SPM) fijo, ej: 20-22.", tips: ["Fija un SPM bajo", "Empuje potente, vuelta lenta", "Controla el carro"], errors: ["Acelerar el retorno para subir SPM", "Cortar la longitud de remada"] },
    { cat: "Cardio", sub: "Remo", name: "Remo potencia relativa", musc: ["Explosividad"], risk: "Mod", cue: "Explota", instr: "Cada remada debe ser al m√°ximo de watts posible. Cadencia baja, fuerza alta.", tips: ["M√°ximo watts por remada", "Baja cadencia", "Descanso breve entre remadas"], errors: ["Usar solo brazos", "Abrir codos al jalar"] },
    { cat: "Cardio", sub: "Remo", name: "Remo HIIT", musc: ["Anaer√≥bico"], risk: "Alto", cue: "Vac√≠a el tanque", instr: "Sprints de 30-60 segundos a m√°xima intensidad.", tips: ["Cadencia alta (>30)", "Recorrido completo aunque canse", "Respira fuerte"], errors: ["Acortar la remada", "Perder postura lumbar"] },
    { cat: "Cardio", sub: "Remo", name: "Remo t√©cnico", musc: ["T√©cnica"], risk: "Bajo", cue: "C√°mara lenta", instr: "Remo muy suave descomponiendo el movimiento en fases marcadas.", tips: ["Exagera la secuencia", "Peque√±a pausa en cada fase", "Sin resistencia"], errors: ["Ir r√°pido", "Mezclar fases"] },
    { cat: "Cardio", sub: "Remo", name: "Remo brazos dominantes", musc: ["B√≠ceps", "Espalda"], risk: "Bajo", cue: "Torso aislado", instr: "Piernas estiradas y fijas. Rema solo flexionando brazos y moviendo ligeramente el torso.", tips: ["Piernas estiradas", "Solo mueve tronco superior", "Hombros abajo"], errors: ["Balancear torso excesivamente", "Subir hombros"] },
    { cat: "Cardio", sub: "Remo", name: "Remo piernas dominantes", musc: ["Cu√°driceps"], risk: "Bajo", cue: "Solo piernas", instr: "Brazos rectos todo el tiempo. Empuja solo con las piernas moviendo el carro.", tips: ["Brazos como cuerdas", "Empuje de sentadilla", "Torso fijo"], errors: ["Doblar codos", "Levantar talones al final"] },
    { cat: "Cardio", sub: "Cuerda", name: "Salto b√°sico", musc: ["Gemelos"], risk: "Bajo", cue: "Rebote en puntas", instr: "Salto con pies juntos. El movimiento sale de las mu√±ecas.", tips: ["Codos pegados a costillas", "Movimiento de mu√±eca", "Salto bajo"], errors: ["Saltar muy alto", "Mover todo el brazo (hombro)"] },
    { cat: "Cardio", sub: "Cuerda", name: "Salto alternado", musc: ["Coordinaci√≥n"], risk: "Bajo", cue: "Jogging est√°tico", instr: "Salta alternando un pie y otro, como si corrieras en el sitio.", tips: ["Rodillas arriba suave", "Ritmo de trote", "Espalda recta"], errors: ["Patear hacia atr√°s (tal√≥n al gl√∫teo)", "Perder ritmo"] },
    { cat: "Cardio", sub: "Cuerda", name: "Salto doble apoyo", musc: ["Gemelos"], risk: "Bajo", cue: "Pies juntos", instr: "Variante b√°sica, aterrizando con ambos pies simult√°neamente.", tips: ["Rodillas semi-flex", "Aterrizaje suave (silencioso)", "Mirada frente"], errors: ["Caer con talones (impacto)", "Rigidez total"] },
    { cat: "Cardio", sub: "Cuerda", name: "Salto r√°pido", musc: ["Agilidad"], risk: "Mod", cue: "Mu√±ecas r√°pidas", instr: "Aumenta la velocidad de giro. Requiere saltos m√°s peque√±os y r√°pidos.", tips: ["Cuerda corta ayuda", "Saltos m√≠nimos del suelo", "Reactividad"], errors: ["Tensar hombros", "Tropezar por levantar mucho los pies"] },
    { cat: "Cardio", sub: "Cuerda", name: "Salto continuo", musc: ["Resistencia"], risk: "Bajo", cue: "Estado zen", instr: "Salto a ritmo constante por tiempo prolongado (5-10 min).", tips: ["Respira r√≠tmico", "Mirada al frente", "M√≠nimo esfuerzo"], errors: ["Mirar al suelo", "Aguantar respiraci√≥n"] },
    { cat: "Cardio", sub: "Cuerda", name: "Intervalos de salto", musc: ["Anaer√≥bico"], risk: "Alto", cue: "Intensidad", instr: "Periodos de m√°xima velocidad seguidos de descanso o salto suave.", tips: ["Acelera 30s a tope", "Descansa 30s", "Mant√©n t√©cnica"], errors: ["Perder t√©cnica por velocidad", "Parar antes de tiempo"] },
    { cat: "Cardio", sub: "Cuerda", name: "Salto como activaci√≥n", musc: ["Calentamiento"], risk: "Bajo", cue: "Sangre a pies", instr: "Saltos muy suaves para calentar tobillos y gemelos.", tips: ["Ritmo muy suave", "3-5 minutos", "Variedad de pasos"], errors: ["Fatigarse antes de entrenar", "Saltos explosivos"] },
    { cat: "Cardio", sub: "Cuerda", name: "Salto como finisher", musc: ["Mental"], risk: "Mod", cue: "Hasta el fallo", instr: "Saltos al final del entreno para vaciar reservas de energ√≠a.", tips: ["Vacia lo que queda", "Mant√©n t√©cnica cansado", "Foco mental"], errors: ["Lesionarse por fatiga", "Mala ca√≠da"] },
    { cat: "Cardio", sub: "Step", name: "Step b√°sico", musc: ["Piernas"], risk: "Bajo", cue: "Pie entero", instr: "Sube y baja del step de frente: sube-sube, baja-baja.", tips: ["Sube tal√≥n completo", "Alterna pierna l√≠der", "Mirada al frente"], errors: ["Dejar tal√≥n fuera", "Golpear suelo fuerte"] },
    { cat: "Cardio", sub: "Step", name: "Step alternado", musc: ["Coordinaci√≥n"], risk: "Bajo", cue: "Cambio de pie", instr: "Toca el step con un pie y cambia en el aire o con ritmo r√°pido.", tips: ["Ritmo constante", "Brazos acompa√±an", "Ligereza"], errors: ["Mirar siempre abajo", "Tropezar"] },
    { cat: "Cardio", sub: "Step", name: "Step lateral", musc: ["Aductores"], risk: "Bajo", cue: "Lado a lado", instr: "Sube al step de lado y baja por el otro lado.", tips: ["Sube y cruza", "Cadera estable", "Pie completo"], errors: ["Cruzar pies en suelo", "Resbalar"] },
    { cat: "Cardio", sub: "Step", name: "Step continuo", musc: ["Resistencia"], risk: "Bajo", cue: "Non-stop", instr: "Mant√©n el movimiento b√°sico sin parar durante 20+ minutos.", tips: ["Altura baja de step", "Ritmo sostenible", "Buena postura"], errors: ["Perder altura", "Fatiga de gemelos"] },
    { cat: "Cardio", sub: "Step", name: "Step con carga", musc: ["Piernas"], risk: "Mod", cue: "Fuerza resistente", instr: "Realiza step b√°sico sosteniendo mancuernas o chaleco lastrado.", tips: ["Mancuernas en manos", "Torso erguido", "Pisa fuerte"], errors: ["Inclinarse adelante", "Balancear peso"] },
    { cat: "Cardio", sub: "Step", name: "Step-ups", musc: ["Gl√∫teos"], risk: "Mod", cue: "Empuja escal√≥n", instr: "Sube al step empujando con una pierna hasta extenderla completa.", tips: ["Foco en pierna de arriba", "Controla bajada", "Torso ligeramente inclinado"], errors: ["Impulso excesivo pierna abajo", "Caer de golpe"] },
    { cat: "Cardio", sub: "Step", name: "Step-downs", musc: ["Exc√©ntrico"], risk: "Bajo", cue: "Baja lento", instr: "Desde arriba del step, baja un pie controlando con la pierna de apoyo.", tips: ["Toca suelo y sube", "Rodilla estable", "Cadera atr√°s"], errors: ["Valgo de rodilla", "Dejarse caer"] },
    { cat: "Cardio", sub: "Step", name: "Step jump controlado", musc: ["Potencia"], risk: "Alto", cue: "Aterriza suave", instr: "Salta con ambos pies al step y baja paso a paso.", tips: ["Salto explosivo", "Amortigua ca√≠da", "Baja caminando"], errors: ["Aterrizar r√≠gido", "Step inestable"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla trasera", musc: ["Cu√°driceps", "Gl√∫teo"], risk: "Mod", cue: "Barra en trapecios", instr: "Barra sobre la espalda alta. Baja cadera y rodillas simult√°neamente.", tips: ["Bracing abdominal", "Rodillas siguen pies", "Pecho arriba"], errors: ["Levantar talones", "Gui√±o de gl√∫teo", "Rodillas valgo"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla frontal", musc: ["Cu√°driceps"], risk: "Mod", cue: "Codos arriba", instr: "Barra en deltoides frontales, codos altos. Torso vertical.", tips: ["Torso muy vertical", "Codos paralelos suelo", "Mirada frente"], errors: ["Bajar codos", "Inclinarse adelante"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla goblet", musc: ["Core", "Piernas"], risk: "Bajo", cue: "Peso al pecho", instr: "Sost√©n pesa al pecho. Baja profunda con codos por dentro de rodillas.", tips: ["Codos dentro de rodillas", "Pecho alto", "Espalda recta"], errors: ["Despegar peso cuerpo", "Redondear espalda"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla con tal√≥n elevado", musc: ["Cu√°driceps"], risk: "Mod", cue: "Rodilla adelante", instr: "Talones sobre discos/cu√±a. Permite mayor profundidad y √©nfasis en cu√°driceps.", tips: ["Espalda recta", "Profundidad m√°xima", "Torso vertical"], errors: ["Perder equilibrio", "Dolor patelar (si hay lesi√≥n previa)"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla pausada", musc: ["Fuerza"], risk: "Mod", cue: "Estatua abajo", instr: "Baja normal, pausa 2-3 segundos en el fondo, sube explosivo.", tips: ["Pausa total", "Mant√©n tensi√≥n", "No rebotes"], errors: ["Relajarse en el fondo", "Pausa muy corta"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla tempo", musc: ["Hipertrofia"], risk: "Mod", cue: "Control 3-1-1", instr: "Baja en 3-4 segundos, sin pausa, sube en 1 segundo.", tips: ["Baja muy lento", "Sube explosivo", "Cuenta mentalmente"], errors: ["Acelerar bajada", "Contar r√°pido"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla parcial", musc: ["Sobrecarga"], risk: "Mod", cue: "Media bajada", instr: "Baja solo hasta media flexi√≥n con m√°s peso del habitual.", tips: ["Carga pesada", "Bloquea arriba", "Core de acero"], errors: ["Bajar demasiado", "Creer que es completa"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla landmine", musc: ["Piernas"], risk: "Bajo", cue: "Ap√≥yate en barra", instr: "Sost√©n el extremo de la barra landmine al pecho. Haz sentadilla.", tips: ["Pies adelantados", "Espalda neutra", "Empuja barra al subir"], errors: ["Pies muy atr√°s", "Rotar hombros"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla b√∫lgara", musc: ["Unilateral"], risk: "Mod", cue: "Peso en tal√≥n", instr: "Un pie apoyado atr√°s. Flexiona rodilla delantera.", tips: ["Inclina torso (gl√∫teo)", "Baja vertical", "Pie trasero relajado"], errors: ["Banco muy alto", "Exceso peso atr√°s"] },
    { cat: "Fuerza", sub: "Sentadilla", name: "Sentadilla split", musc: ["Piernas"], risk: "Bajo", cue: "Ascensor", instr: "Posici√≥n de zancada est√°tica. Sube y baja verticalmente.", tips: ["Baja recto", "Rodilla casi toca suelo", "Pies fijos"], errors: ["Rodilla pasa mucho punta", "Golpear suelo"] },
    { cat: "Fuerza", sub: "Bisagra", name: "Peso muerto convencional", musc: ["Cadena posterior"], risk: "Mod", cue: "Empuja suelo", instr: "Barra en suelo. Levanta extendiendo cadera y rodillas.", tips: ["Barra pegada piernas", "Tensa dorsales", "Espalda neutra"], errors: ["Gato lumbar", "Tirar con brazos"] },
    { cat: "Fuerza", sub: "Bisagra", name: "Peso muerto rumano", musc: ["Isquios"], risk: "Mod", cue: "Cadera atr√°s", instr: "Desde arriba, baja barra deslizando por muslos, cadera atr√°s.", tips: ["Rodillas semi-flex fijas", "Siente estir√≥n", "No toques suelo"], errors: ["Bajar barra lejos", "Doblar rodillas de m√°s"] },
    { cat: "Fuerza", sub: "Bisagra", name: "Peso muerto sumo", musc: ["Gl√∫teo"], risk: "Mod", cue: "Abre el suelo", instr: "Pies anchos, manos por dentro. Torso m√°s vertical.", tips: ["Pies anchos", "Abre rodillas", "Torso vertical"], errors: ["Cerrar rodillas", "Cadera muy alta"] },
    { cat: "Fuerza", sub: "Bisagra", name: "Peso muerto con d√©ficit", musc: ["Cadena posterior"], risk: "Alto", cue: "Rango extra", instr: "Pies sobre disco/plataforma. Aumenta el recorrido de la barra.", tips: ["Usa plataforma baja", "Mant√©n espalda", "Flexibilidad necesaria"], errors: ["Perder lumbar abajo", "Rebotar discos"] },
    { cat: "Fuerza", sub: "Bisagra", name: "Peso muerto con tal√≥n elevado", musc: ["Cu√°driceps"], risk: "Mod", cue: "H√≠brido", instr: "Talones elevados. Desplaza √©nfasis hacia cu√°driceps.", tips: ["Mayor flexi√≥n rodilla", "Espalda recta", "Pecho alto"], errors: ["Levantar talones m√°s", "Inestabilidad"] },
    { cat: "Fuerza", sub: "Bisagra", name: "Peso muerto landmine", musc: ["Gl√∫teos"], risk: "Bajo", cue: "Bisagra pura", instr: "Barra entre las piernas. Agarre en V o directo a la barra.", tips: ["Barra entre piernas", "Espalda plana", "Cadera atr√°s"], errors: ["Curvar espalda alta", "Hombros a orejas"] },
    { cat: "Fuerza", sub: "Bisagra", name: "Good mornings", musc: ["Erectores"], risk: "Mod", cue: "Reverencia", instr: "Barra en espalda. Inclina torso adelante llevando cadera atr√°s.", tips: ["Rodillas semi-flex", "Cadera muy atr√°s", "Pecho paralelo suelo"], errors: ["Doblar rodillas (sentadilla)", "Bajar pecho sin cadera"] },
    { cat: "Fuerza", sub: "Bisagra", name: "Hip hinge con kettlebell", musc: ["Gl√∫teos"], risk: "Bajo", cue: "Toca pared", instr: "Pesa pegada al cuerpo. Empuja cadera atr√°s hasta sentir isquios.", tips: ["Pesa cerca ingle", "Contrae gl√∫teo arriba", "Espalda neutra"], errors: ["Sentadilla con pesa", "Hiperextensi√≥n lumbar"] },
    { cat: "Fuerza", sub: "Empuje H", name: "Press banca plano", musc: ["Pecho"], risk: "Mod", cue: "Retrae esc√°pulas", instr: "Acostado, barra al pecho and empuja.", tips: ["Arco natural", "Pies firmes", "Codos 45¬∫"], errors: ["Despegar gl√∫teo", "Rebotar barra"] },
    { cat: "Fuerza", sub: "Empuje H", name: "Press banca inclinado", musc: ["Pecho superior"], risk: "Mod", cue: "Toca clav√≠cula", instr: "Banco a 30-45 grados. Barra a parte alta del pecho.", tips: ["Banco a 30-45¬∫", "Codos a 45¬∫", "Controla bajada"], errors: ["Banco muy vertical", "Arquear demasiado"] },
    { cat: "Fuerza", sub: "Empuje H", name: "Press banca declinado", musc: ["Pecho inferior"], risk: "Mod", cue: "Control", instr: "Cabeza m√°s baja que pies. Enfoca parte baja del pecho.", tips: ["Engancha pies bien", "Baja a pecho bajo", "Cuidado al sacar barra"], errors: ["Rango corto", "Barra al cuello"] },
    { cat: "Fuerza", sub: "Empuje H", name: "Press con mancuernas", musc: ["Estabilidad"], risk: "Bajo", cue: "Converge", instr: "Mancuernas permiten juntar manos arriba (convergencia).", tips: ["Junta arriba sin tocar", "Baja profundo", "Controla bajada"], errors: ["Chocar mancuernas", "Perder balance"] },
    { cat: "Fuerza", sub: "Empuje H", name: "Press agarre cerrado", musc: ["Tr√≠ceps"], risk: "Bajo", cue: "Codos pegados", instr: "Manos ancho de hombros. Codos rozan costillas al bajar.", tips: ["Manos ancho hombros", "Abre codos levemente", "Barra bajo pecho"], errors: ["Manos muy juntas", "Abrir codos"] },
    { cat: "Fuerza", sub: "Empuje H", name: "Press unilateral", musc: ["Core"], risk: "Mod", cue: "No rotes", instr: "Press banca con una sola mancuerna. Core evita rotaci√≥n.", tips: ["Gl√∫teo opuesto fuerte", "Baja controlado", "Cuerpo plano"], errors: ["Girar torso", "Caerse del banco"] },
    { cat: "Fuerza", sub: "Empuje H", name: "Press landmine", musc: ["Pecho alto"], risk: "Bajo", cue: "Empuja al frente", instr: "De pie, empuja el extremo de la barra hacia adelante y arriba.", tips: ["Incl√≠nate un poco", "Brazo extiende total", "Core activo"], errors: ["Arquear lumbar", "Girar hombros"] },
    { cat: "Fuerza", sub: "Empuje V", name: "Press militar", musc: ["Hombros"], risk: "Mod", cue: "Cabeza asoma", instr: "De pie, press estricto con barra sobre la cabeza.", tips: ["Gl√∫teo apretado", "Barra vertical", "Bloquea codos"], errors: ["Arquear lumbar", "Impulso rodillas"] },
    { cat: "Fuerza", sub: "Empuje V", name: "Press militar sentado", musc: ["Hombros"], risk: "Bajo", cue: "Espalda apoyada", instr: "Sentado con respaldo. Press de hombros con barra o mancuernas.", tips: ["Sin impulso", "Baja a barrilla", "Espalda pegada"], errors: ["Despegar espalda", "Rango parcial"] },
    { cat: "Fuerza", sub: "Empuje V", name: "Press Arnold", musc: ["Deltoides"], risk: "Bajo", cue: "Giro fluido", instr: "Mancuernas: inicia palmas hacia ti, gira al subir a palmas frente.", tips: ["Giro suave", "Control total", "Rango completo"], errors: ["Golpear arriba", "Girar tarde"] },
    { cat: "Fuerza", sub: "Empuje V", name: "Push press", musc: ["Potencia"], risk: "Mod", cue: "Dip and drive", instr: "Usa un peque√±o impulso de piernas para iniciar el press.", tips: ["Impulso piernas", "Bloqueo r√°pido", "Bajada amortiguada"], errors: ["Sentadilla profunda", "Press estricto (sin piernas)"] },
    { cat: "Fuerza", sub: "Empuje V", name: "Press landmine unilateral", musc: ["Hombro"], risk: "Bajo", cue: "Diagonal", instr: "Rodilla en suelo o de pie. Empuja barra landmine con una mano.", tips: ["Core activo", "No rotes", "Sigue la l√≠nea"], errors: ["Inclinarse al lado", "Hombro a oreja"] },
    { cat: "Fuerza", sub: "Empuje V", name: "Thruster con barra", musc: ["Metab√≥lico"], risk: "Alto", cue: "Fluido", instr: "Sentadilla frontal + Press militar en un solo movimiento fluido.", tips: ["Sentadilla a press", "Barra en hombros", "Explosivo"], errors: ["Parar en el medio", "Press adelantado"] },
    { cat: "Fuerza", sub: "Empuje V", name: "Thruster con mancuernas", musc: ["Full body"], risk: "Alto", cue: "Explosivo", instr: "Igual que barra pero con mancuernas. M√°s estabilidad requerida.", tips: ["Pesas en hombros", "Empuja con cadera", "Brazos extienden"], errors: ["Bajar torso", "Falta coordinaci√≥n"] },
    { cat: "Fuerza", sub: "Empuje V", name: "Thruster landmine", musc: ["Full body"], risk: "Mod", cue: "Empuje 2 manos", instr: "Sentadilla sosteniendo landmine + press al subir.", tips: ["Sentadilla profunda", "Extensi√≥n completa", "Inclinaci√≥n leve"], errors: ["Perder barra", "Espalda curva"] },
    { cat: "Fuerza", sub: "Tracci√≥n H", name: "Remo con barra", musc: ["Espalda"], risk: "Mod", cue: "A la cadera", instr: "Torso inclinado. Jala barra a la cadera/abdomen.", tips: ["Torso 45¬∫", "Codos atr√°s", "Espalda recta"], errors: ["Kipping", "Torso muy vertical"] },
    { cat: "Fuerza", sub: "Tracci√≥n H", name: "Remo Pendlay", musc: ["Potencia"], risk: "Mod", cue: "Desde el suelo", instr: "Espalda paralela al suelo. Cada repe empieza en el suelo muerto.", tips: ["Paralelo suelo", "Explosivo", "Deja caer (controlado)"], errors: ["Levantar pecho", "No tocar suelo"] },
    { cat: "Fuerza", sub: "Tracci√≥n H", name: "Remo con mancuernas", musc: ["Dorsal"], risk: "Bajo", cue: "Codo a bolsillo", instr: "Mano en banco. Jala mancuerna a la cadera.", tips: ["Apoyo estable", "Sin rotar", "Codo pegado"], errors: ["Girar torso", "Tirar al pecho"] },
    { cat: "Fuerza", sub: "Tracci√≥n H", name: "Remo unilateral", musc: ["Core"], risk: "Bajo", cue: "Simetr√≠a", instr: "Remo a una mano, de pie o con apoyo.", tips: ["Espalda plana", "Core evita giro", "Retracci√≥n"], errors: ["Hombro ca√≠do", "Tir√≥n b√≠ceps"] },
    { cat: "Fuerza", sub: "Tracci√≥n H", name: "Remo landmine", musc: ["Espalda media"], risk: "Bajo", cue: "Barra entre piernas", instr: "Agarre V en barra T/Landmine. Jala al pecho.", tips: ["Pecho fuera", "Codos atr√°s", "Espalda recta"], errors: ["Chepa", "Rango corto"] },
    { cat: "Fuerza", sub: "Tracci√≥n H", name: "Remo en T con V-bar", musc: ["Espalda"], risk: "Mod", cue: "Junta esc√°pulas", instr: "M√°quina T-bar o barra en esquina. Agarre cerrado.", tips: ["Rodillas flex", "Codos pegados", "Junta paletillas"], errors: ["Impulso lumbar", "Cuello tenso"] },
    { cat: "Fuerza", sub: "Tracci√≥n H", name: "Remo agarre neutro", musc: ["Dorsal bajo"], risk: "Bajo", cue: "Palmas enfrentadas", instr: "Remo (m√°quina o polea) con palmas mir√°ndose.", tips: ["Codos rozan costillas", "Retracci√≥n", "Pecho alto"], errors: ["Abrir codos", "Hombros arriba"] },
    { cat: "Fuerza", sub: "Tracci√≥n H", name: "Remo tempo", musc: ["Hipertrofia"], risk: "Bajo", cue: "Aprieta y estira", instr: "Remo realizado muy lento, enfatizando la negativa.", tips: ["Pausa atr√°s", "Estira lento (3s)", "Siente m√∫sculo"], errors: ["Perder tensi√≥n", "Acelerar"] },
    { cat: "Fuerza", sub: "Tracci√≥n V", name: "Dominadas estrictas", musc: ["Dorsales"], risk: "Mod", cue: "Pecho a barra", instr: "Palmas al frente. Sube hasta pasar barbilla.", tips: ["Depresi√≥n escapular", "Piernas quietas", "Baja completo"], errors: ["Patada (kipping)", "No estirar abajo"] },
    { cat: "Fuerza", sub: "Tracci√≥n V", name: "Dominadas asistidas", musc: ["Dorsales"], risk: "Bajo", cue: "Control", instr: "Usa m√°quina o banda el√°stica para reducir el peso.", tips: ["T√©cnica perfecta", "Rango completo", "Controla bajada"], errors: ["Dejarse caer", "Ayuda excesiva"] },
    { cat: "Fuerza", sub: "Tracci√≥n V", name: "Chin-ups", musc: ["B√≠ceps"], risk: "Mod", cue: "Palmas a ti", instr: "Agarre supino (palmas a cara). Enfoca b√≠ceps.", tips: ["Cierra √°ngulo codo", "Baja completo", "Pecho arriba"], errors: ["Medias reps", "Hombros adelante"] },
    { cat: "Fuerza", sub: "Tracci√≥n V", name: "Chin-ups asistidos", musc: ["B√≠ceps"], risk: "Bajo", cue: "Rango total", instr: "Chin-ups con ayuda de banda o m√°quina.", tips: ["Foco en brazos", "Cuerpo recto", "Movimiento lento"], errors: ["Balanceo", "No bloquear"] },
    { cat: "Fuerza", sub: "Tracci√≥n V", name: "Dominadas exc√©ntricas", musc: ["Fuerza"], risk: "Bajo", cue: "Baja en 5s", instr: "Salta para subir y baja resistiendo la gravedad muy lento.", tips: ["Salta para subir", "Frena la bajada", "Tensi√≥n total"], errors: ["Caer r√°pido", "No controlar"] },
    { cat: "Fuerza", sub: "Tracci√≥n V", name: "Dominadas isom√©tricas", musc: ["Est√°tica"], risk: "Bajo", cue: "Aguanta arriba", instr: "Sube y mant√©n la posici√≥n arriba el m√°ximo tiempo.", tips: ["Barbilla sobre barra", "Hombros abajo", "Respira"], errors: ["Temblar mucho", "Cuello tenso"] },
    { cat: "Fuerza", sub: "Tracci√≥n V", name: "Dominadas con banda", musc: ["Potencia"], risk: "Bajo", cue: "Explota", instr: "Banda bajo el pie/rodilla ayuda a subir.", tips: ["Pie en banda", "Sube r√°pido", "Controla el rebote"], errors: ["Golpe de banda", "No estirar"] },
    { cat: "Fuerza", sub: "Tracci√≥n V", name: "Pull-ups con agarre neutro", musc: ["Braquial"], risk: "Bajo", cue: "Manos paralelas", instr: "Agarre neutro (manoplas paralelas). M√°s c√≥modo para hombros.", tips: ["Pecho a agarre", "Codos al frente", "Retracci√≥n"], errors: ["Abrir codos", "No subir suficiente"] },
    { cat: "Fuerza", sub: "Brazos", name: "Curl b√≠ceps con barra", musc: ["B√≠ceps"], risk: "Bajo", cue: "Codos fijos", instr: "De pie, eleva la barra flexionando codos.", tips: ["Sin balanceo", "Aprieta arriba", "Baja lento"], errors: ["Mover codos adelante", "Lumbar atr√°s"] },
    { cat: "Fuerza", sub: "Brazos", name: "Curl b√≠ceps con barra Z", musc: ["B√≠ceps"], risk: "Bajo", cue: "Mu√±eca c√≥moda", instr: "Usa barra Z para menor estr√©s en mu√±ecas.", tips: ["Agarre angulado", "Estricto", "Codos pegados"], errors: ["Mu√±eca doblada", "Impulso"] },
    { cat: "Fuerza", sub: "Brazos", name: "Curl alterno", musc: ["B√≠ceps"], risk: "Bajo", cue: "Gira mu√±eca", instr: "Mancuernas. Sube una y luego la otra, girando palma.", tips: ["Supina al subir", "Controla bajada", "Torso quieto"], errors: ["Balancear cuerpo", "No girar"] },
    { cat: "Fuerza", sub: "Brazos", name: "Curl martillo", musc: ["Braquial"], risk: "Bajo", cue: "Pulgar arriba", instr: "Palmas enfrentadas todo el movimiento.", tips: ["Agarre neutro", "Codos pegados", "Firmeza"], errors: ["Mover codos", "Hombros arriba"] },
    { cat: "Fuerza", sub: "Brazos", name: "Curl concentraci√≥n", musc: ["Pico b√≠ceps"], risk: "Bajo", cue: "A√≠sla", instr: "Sentado, codo apoyado en cara interna del muslo.", tips: ["Codo fijo", "Sin mover pierna", "M√°xima contracci√≥n"], errors: ["Ayuda con hombro", "No estirar"] },
    { cat: "Fuerza", sub: "Brazos", name: "Curl inclinado", musc: ["Cabeza larga"], risk: "Bajo", cue: "Brazos atr√°s", instr: "Sentado en banco inclinado. Brazos cuelgan atr√°s.", tips: ["Banco 45¬∫", "Codos fijos atr√°s", "Estiramiento"], errors: ["Adelantar codos", "Cabeza levantada"] },
    { cat: "Fuerza", sub: "Brazos", name: "Extensi√≥n de tr√≠ceps con barra", musc: ["Tr√≠ceps"], risk: "Bajo", cue: "Solo antebrazo", instr: "De pie o acostado, extiende codos.", tips: ["Codos fijos", "Barra a frente/arriba", "Aisla tr√≠ceps"], errors: ["Abrir codos", "Mover hombro"] },
    { cat: "Fuerza", sub: "Brazos", name: "Skull crushers", musc: ["Tr√≠ceps"], risk: "Mod", cue: "A la frente", instr: "Acostado, baja barra a la frente flexionando codos.", tips: ["Control total", "Codos cerrados", "No te golpees"], errors: ["Barra a nariz", "Codos muy abiertos"] },
    { cat: "Fuerza", sub: "Brazos", name: "Extensi√≥n overhead", musc: ["Tr√≠ceps"], risk: "Bajo", cue: "Estira tr√≠ceps", instr: "Pesa tras nuca. Extiende brazo arriba.", tips: ["Codos apuntan techo", "Espalda recta", "Rango completo"], errors: ["Arquear lumbar", "Codos afuera"] },
    { cat: "Fuerza", sub: "Brazos", name: "Press cerrado", musc: ["Tr√≠ceps"], risk: "Mod", cue: "Roza costillas", instr: "Press banca con manos ancho de hombros.", tips: ["Agarre hombros", "Codos pegados", "Empuja fuerte"], errors: ["Manos muy juntas", "Abrir codos"] },
    { cat: "Fuerza", sub: "Brazos", name: "Fondos en paralelas", musc: ["Tr√≠ceps"], risk: "Mod", cue: "Vertical", instr: "Mant√©n cuerpo vertical para enfocar tr√≠ceps.", tips: ["Torso recto", "Baja a 90¬∫", "Codos atr√°s"], errors: ["Hombros a orejas", "Bajar poco"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Fondos", musc: ["Pecho", "Tr√≠ceps"], risk: "Mod", cue: "Rango completo", instr: "Baja cuerpo entre barras.", tips: ["Codos atr√°s", "Control", "Hombros sanos"], errors: ["Hombros rotados", "Kipping"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Fondos asistidos", musc: ["Tr√≠ceps"], risk: "Bajo", cue: "Ayuda banda", instr: "Fondos con banda o m√°quina de ayuda.", tips: ["Rodilla en banda", "T√©cnica", "Progresi√≥n"], errors: ["Rebote banda", "Mala postura"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Fondos profundos", musc: ["Movilidad"], risk: "Alto", cue: "Estira pecho", instr: "Baja m√°s all√° de 90 grados (solo avanzados).", tips: ["Baja extra", "Control extremo", "Flexibilidad"], errors: ["Dolor hombro", "Caer r√°pido"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Fondos con pausa", musc: ["Fuerza"], risk: "Mod", cue: "Para abajo", instr: "Pausa en el punto m√°s bajo 2 segundos.", tips: ["2 seg fondo", "Explota", "Estabilidad"], errors: ["Sin pausa real", "Perder tensi√≥n"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Fondos tempo", musc: ["Hipertrofia"], risk: "Mod", cue: "C√°mara lenta", instr: "Baja en 3-4 segundos.", tips: ["3-4 seg bajada", "Sube 1s", "Quema"], errors: ["Acelerar", "Contar r√°pido"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Soporte isom√©trico", musc: ["Estabilidad"], risk: "Bajo", cue: "Bloqueo", instr: "Sostente arriba con brazos rectos.", tips: ["Brazos rectos", "Esc√°pulas abajo", "Cuello largo"], errors: ["Doblar codos", "Hundir cuello"] },
    { cat: "Calistenia", sub: "Paralelas", name: "L-sit", musc: ["Core"], risk: "Mod", cue: "Cuerpo en L", instr: "Eleva piernas rectas formando una L.", tips: ["Piernas rectas", "Empuja barras", "Puntas estiradas"], errors: ["Doblar rodillas", "Hombros arriba"] },
    { cat: "Calistenia", sub: "Paralelas", name: "L-sit raises", musc: ["Flexores"], risk: "Mod", cue: "Sube y baja", instr: "Sube piernas a L y baja repetidamente.", tips: ["Controlado", "Sin impulso", "Core fuerte"], errors: ["Balanceo", "Doblar piernas"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Elevaciones de rodillas", musc: ["Abs bajos"], risk: "Bajo", cue: "Rodillas pecho", instr: "Cuelga y sube rodillas al pecho.", tips: ["Pelvis adelante", "Control", "No balanc√©es"], errors: ["Balanceo", "Solo mover piernas"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Elevaciones de piernas", musc: ["Abs"], risk: "Mod", cue: "Puntas arriba", instr: "Cuelga y sube piernas rectas.", tips: ["Piernas rectas", "Cadera gira", "Control"], errors: ["Impulso", "Lumbar suelta"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Remo invertido", musc: ["Espalda"], risk: "Bajo", cue: "Tabla r√≠gida", instr: "Cuerpo bajo barra, pies en suelo. Jala pecho a barra.", tips: ["Cuerpo recto", "Pecho a barra", "Retracci√≥n"], errors: ["Cadera cae", "Cabeza adelante"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Remo invertido unilateral", musc: ["Anti-rotaci√≥n"], risk: "Mod", cue: "Un brazo", instr: "Remo invertido a una mano.", tips: ["Cuerpo plano", "Sin girar", "Brazo libre ayuda eq"], errors: ["Rotar tronco", "Caerse"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Flexiones profundas", musc: ["Pecho"], risk: "Mod", cue: "Pecho pasa manos", instr: "Manos en paralelas, permite bajar m√°s el pecho.", tips: ["Manos en barras", "Baja mucho", "Estira pectoral"], errors: ["Hombros dolor", "Lumbar cae"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Flexiones declinadas", musc: ["Pecho alto"], risk: "Bajo", cue: "Pies arriba", instr: "Pies en barras/banco, manos en suelo.", tips: ["Pies altos", "Cuerpo recto", "Mirada suelo"], errors: ["Curvar lumbar", "Golpear cara"] },
    { cat: "Calistenia", sub: "Paralelas", name: "Pike push-ups", musc: ["Hombros"], risk: "Mod", cue: "V invertida", instr: "Cuerpo en V. Baja cabeza al suelo.", tips: ["Cadera alto", "Cabeza adelante manos", "Codos dentro"], errors: ["Codos fuera", "Cadera baja"] },
    { cat: "Calistenia", sub: "Suelo", name: "Flexiones", musc: ["Pecho"], risk: "Bajo", cue: "Tabla", instr: "Pecho al suelo, cuerpo recto.", tips: ["Codos 45¬∫", "Toca pecho", "Core duro"], errors: ["Cadera cae", "Cuello tenso"] },
    { cat: "Calistenia", sub: "Suelo", name: "Flexiones cerradas", musc: ["Tr√≠ceps"], risk: "Bajo", cue: "Pegadito", instr: "Manos ancho hombros, codos pegados.", tips: ["Manos juntas", "Codos pegados", "Tr√≠ceps arde"], errors: ["Manos muy juntas", "Codos abiertos"] },
    { cat: "Calistenia", sub: "Suelo", name: "Flexiones diamante", musc: ["Tr√≠ceps"], risk: "Bajo", cue: "Forma rombo", instr: "√çndice y pulgar forman diamante.", tips: ["√çndices tocan", "Pecho a manos", "Dif√≠cil"], errors: ["Mu√±ecas dolor", "No bajar"] },
    { cat: "Calistenia", sub: "Suelo", name: "Flexiones inclinadas", musc: ["Pecho bajo"], risk: "Bajo", cue: "Manos altas", instr: "Manos en banco/pared. M√°s f√°cil.", tips: ["Manos en banco", "Cuerpo recto", "Pecho a borde"], errors: ["Cadera atr√°s", "Hombros arriba"] },
    { cat: "Calistenia", sub: "Suelo", name: "Flexiones declinadas", musc: ["Pecho alto"], risk: "Bajo", cue: "Pies banco", instr: "Pies elevados. Enfoca hombro/pecho alto.", tips: ["Cuerpo recto", "Mirada suelo", "Control"], errors: ["Curvar lumbar", "Golpear cara"] },
    { cat: "Calistenia", sub: "Suelo", name: "Planchas", musc: ["Isom√©trico"], risk: "Bajo", cue: "Roca", instr: "Apoyo antebrazos. Aguanta recto.", tips: ["Protracci√≥n", "Gl√∫teo duro", "Respira"], errors: ["Pico cadera", "Hamaca lumbar"] },
    { cat: "Calistenia", sub: "Suelo", name: "Planchas laterales", musc: ["Oblicuos"], risk: "Bajo", cue: "L√≠nea recta", instr: "De lado, apoyo en un antebrazo.", tips: ["Codo bajo hombro", "Cadera alta", "Alineado"], errors: ["Rotar hombro", "Cadera cae"] },
    { cat: "Calistenia", sub: "Suelo", name: "Hollow body hold", musc: ["Core"], risk: "Mod", cue: "Pl√°tano", instr: "Tumbado, levanta pies y hombros. Lumbar pegada.", tips: ["Lumbar pegada suelo", "Pies/hombros aire", "Brazos atr√°s"], errors: ["Arco lumbar", "Cuello dolor"] },
    { cat: "Calistenia", sub: "Suelo", name: "Superman hold", musc: ["Lumbares"], risk: "Bajo", cue: "Vuela", instr: "Boca abajo, levanta pecho y piernas.", tips: ["Pecho y muslos arriba", "Gl√∫teo activo", "Aguanta"], errors: ["Tensi√≥n cuello", "Doblar rodillas"] },
    { cat: "Calistenia", sub: "Suelo", name: "Bird dog", musc: ["Estabilidad"], risk: "Bajo", cue: "Cruzado", instr: "Cuadrupedia. Estira brazo y pierna contraria.", tips: ["Mano/pie opuesto", "Espalda plana", "Lento"], errors: ["Rotar cadera", "Levantar mucho"] },
    { cat: "Calistenia", sub: "Suelo", name: "Dead bug", musc: ["Coordinaci√≥n"], risk: "Bajo", cue: "Bicho muerto", instr: "Boca arriba, baja brazo y pierna contraria sin despegar lumbar.", tips: ["Lumbar pegada", "Lento", "Control"], errors: ["Despegar lumbar", "R√°pido"] },
    { cat: "Core", sub: "Ab Coaster", name: "Abdominal central", musc: ["Abs"], risk: "Bajo", cue: "Rodillas pecho", instr: "M√°quina Ab Coaster. Sube rodillas al frente.", tips: ["Usa abs no brazos", "Controla bajada", "Mirada frente"], errors: ["Tirar de brazos", "Golpear abajo"] },
    { cat: "Core", sub: "Ab Coaster", name: "Abdominal oblicuo izquierdo", musc: ["Oblicuos"], risk: "Bajo", cue: "Gira cadera", instr: "Gira asiento a izquierda. Sube rodillas.", tips: ["Rodillas a un lado", "Torsi√≥n", "Aprieta"], errors: ["Giro incompleto", "Mala postura"] },
    { cat: "Core", sub: "Ab Coaster", name: "Abdominal oblicuo derecho", musc: ["Oblicuos"], risk: "Bajo", cue: "Gira cadera", instr: "Gira asiento a derecha. Sube rodillas.", tips: ["Rodillas lado der", "Aprieta costado", "Control"], errors: ["Giro incompleto", "Rapidez"] },
    { cat: "Core", sub: "Ab Coaster", name: "Abdominal con pausa", musc: ["Fuerza"], risk: "Bajo", cue: "Aguanta arriba", instr: "Pausa 2 segundos en el tope.", tips: ["Sube y para", "Baja lento", "Tensi√≥n"], errors: ["Sin pausa", "Rebote"] },
    { cat: "Core", sub: "Ab Coaster", name: "Abdominal tempo", musc: ["Resistencia"], risk: "Bajo", cue: "Lento", instr: "Movimiento muy lento subiendo y bajando.", tips: ["3s subir 3s bajar", "Constante", "Quema"], errors: ["Acelerar", "Impulso"] },
    { cat: "Core", sub: "Ab Coaster", name: "Abdominal con sobrecarga", musc: ["Hipertrofia"], risk: "Mod", cue: "Peso extra", instr: "A√±ade discos a la m√°quina.", tips: ["A√±ade discos", "T√©cnica estricta", "Fuerza"], errors: ["Exceso peso", "Tirar de cuello"] },
    { cat: "Core", sub: "Rueda", name: "Roll-out desde rodillas", musc: ["Anti-extensi√≥n"], risk: "Mod", cue: "Cadera neutra", instr: "Rodillas en suelo. Rueda adelante sin arquear espalda.", tips: ["No dejes culo atr√°s", "Vuelve con abs", "Rango controlable"], errors: ["Culo pollo", "Hamaca lumbar"] },
    { cat: "Core", sub: "Rueda", name: "Roll-out desde pies", musc: ["Pro"], risk: "Alto", cue: "Total", instr: "De pie. Rueda adelante (muy avanzado).", tips: ["Cuerpo tabla", "Tensi√≥n extrema", "Solo expertos"], errors: ["Caer al suelo", "Romper lumbar"] },
    { cat: "Core", sub: "Rueda", name: "Roll-out oblicuo", musc: ["Oblicuos"], risk: "Mod", cue: "Diagonal", instr: "Rueda hacia un lado (45 grados).", tips: ["Sal hacia un lado", "Control", "Vuelve centro"], errors: ["Torcerse", "Hombro inestable"] },
    { cat: "Core", sub: "Rueda", name: "Roll-out parcial", musc: ["Inicio"], risk: "Bajo", cue: "Tope pared", instr: "Rueda hasta chocar con pared para limitar rango.", tips: ["Usa tope", "Rango seguro", "Progresi√≥n"], errors: ["Pasarse", "Miedo"] },
    { cat: "Core", sub: "Rueda", name: "Roll-out isom√©trico", musc: ["Est√°tica"], risk: "Mod", cue: "Congela", instr: "Rueda y mant√©n the posici√≥n extendida.", tips: ["Extiende y para", "Aguanta", "Respira corto"], errors: ["Temblar lumbar", "Hombros orejas"] },
    { cat: "Core", sub: "Funcional", name: "Russian twist", musc: ["Oblicuos"], risk: "Mod", cue: "Gira hombros", instr: "Sentado en V, gira torso lado a lado con peso.", tips: ["Mirada sigue manos", "Pies aire opcional", "Giro controlado"], errors: ["Solo mover manos", "Espalda chepa"] },
    { cat: "Core", sub: "Funcional", name: "Landmine rotations", musc: ["Potencia"], risk: "Mod", cue: "Arco iris", instr: "Barra landmine. Gira de cadera a cadera trazando un arco.", tips: ["Brazos rectos", "Gira cadera/pie", "Explosivo"], errors: ["Doblar codos", "Pies fijos"] },
    { cat: "Core", sub: "Funcional", name: "Anti-rotaci√≥n con banda", musc: ["Estabilidad"], risk: "Bajo", cue: "Centro", instr: "Sost√©n banda lateralmente en el centro del pecho.", tips: ["Banda lateral", "Manos al pecho", "Resiste"], errors: ["Dejarse girar", "Hombros tensos"] },
    { cat: "Core", sub: "Funcional", name: "Pallof press", musc: ["Anti-rotaci√≥n"], risk: "Bajo", cue: "Empuja frente", instr: "Banda lateral. Empuja y recoge brazos al frente.", tips: ["Resiste giro", "Brazos estirados", "Pies firmes"], errors: ["Rotar tronco", "Mover pies"] },
    { cat: "Core", sub: "Funcional", name: "Carry frontal", musc: ["Anterior"], risk: "Bajo", cue: "Peso delante", instr: "Camina sosteniendo peso al pecho o en rack.", tips: ["Sandbag/KB", "No arquear atr√°s", "Pasos cortos"], errors: ["Inclinarse atr√°s", "Hombros arriba"] },
    { cat: "Core", sub: "Funcional", name: "Carry unilateral", musc: ["Lateral"], risk: "Bajo", cue: "Maleta", instr: "Camina con peso en una sola mano.", tips: ["Cuerpo recto", "Sin compensar", "Hombros nivelados"], errors: ["Inclinarse al peso", "Brazo separado"] },
    { cat: "Core", sub: "Funcional", name: "Farmer carry", musc: ["Carga"], risk: "Bajo", cue: "Pesado", instr: "Camina con peso pesado en ambas manos.", tips: ["Pasos cortos", "Hombros atr√°s", "Agarre fuerte"], errors: ["Chepa", "Balanceo carga"] },
    { cat: "Core", sub: "Funcional", name: "Offset carry", musc: ["Asimetr√≠a"], risk: "Bajo", cue: "Desigual", instr: "Pesos diferentes en cada mano.", tips: ["Pesos distintos", "Mant√©n centro", "Desaf√≠o"], errors: ["Torcerse", "Correr"] },
    { cat: "Kettlebells", sub: "Bal√≠stico", name: "Kettlebell swing", musc: ["Cadena posterior"], risk: "Mod", cue: "Cadera pum", instr: "Balanceo de pesa rusa desde la cadera.", tips: ["Bisagra no sentadilla", "Brazos cuerda", "Explosivo"], errors: ["Usar hombros", "Bajar sentadilla"] },
    { cat: "Kettlebells", sub: "Pierna", name: "Goblet squat", musc: ["Piernas"], risk: "Bajo", cue: "Codos dentro", instr: "Sentadilla sosteniendo KB al pecho.", tips: ["Pesa pegada pecho", "Profundo", "Espalda recta"], errors: ["Pesa lejos", "Codos fuera"] },
    { cat: "Kettlebells", sub: "Bisagra", name: "Deadlift con kettlebell", musc: ["Isquios"], risk: "Bajo", cue: "Entre pies", instr: "Peso muerto con KB entre los pies.", tips: ["Asa a tobillos", "Espalda plana", "Empuja suelo"], errors: ["Pesa adelante", "Curvar espalda"] },
    { cat: "Kettlebells", sub: "Potencia", name: "Clean", musc: ["Cuerpo"], risk: "Mod", cue: "Cremallera", instr: "Lleva la KB del suelo al pecho (rack) suavemente.", tips: ["Pesa pegada cuerpo", "Codo r√°pido", "Amortigua"], errors: ["Golpe en mu√±eca", "Arco amplio"] },
    { cat: "Kettlebells", sub: "Complejo", name: "Clean & press", musc: ["Full body"], risk: "Mod", cue: "Fluido", instr: "Clean seguido de press militar.", tips: ["Clean suave", "Press estricto", "Coordina"], errors: ["Golpe antebrazo", "Hiperextensi√≥n"] },
    { cat: "Kettlebells", sub: "Empuje", name: "Press unilateral", musc: ["Hombro"], risk: "Mod", cue: "Costillas abajo", instr: "Press militar a una mano.", tips: ["Mu√±eca recta", "Antebrazo vertical", "Core activo"], errors: ["Arquearse", "Mu√±eca rota"] },
    { cat: "Kettlebells", sub: "Movilidad", name: "Halo", musc: ["Hombros"], risk: "Bajo", cue: "Aureola", instr: "Pasa la KB alrededor de la cabeza.", tips: ["Pesa rodea cabeza", "Codos arriba", "Torso quieto"], errors: ["Golpear cabeza", "Mover torso"] },
    { cat: "Kettlebells", sub: "Carry", name: "Front carry", musc: ["Core"], risk: "Bajo", cue: "Rack position", instr: "Camina con KB en posici√≥n de rack (pecho).", tips: ["Mano en pecho", "Codo pegado", "Vertical"], errors: ["Mu√±eca doblada", "Echarse atr√°s"] },
    { cat: "Kettlebells", sub: "Carry", name: "Suitcase carry", musc: ["Oblicuos"], risk: "Bajo", cue: "Maleta", instr: "Camina con KB al lado como maleta.", tips: ["Espacio axila", "Recto", "Sin tocar pierna"], errors: ["Pesa toca pierna", "Inclinarse"] },
    { cat: "Kettlebells", sub: "Carry", name: "Marcha cargada", musc: ["Estabilidad"], risk: "Bajo", cue: "Rodillas altas", instr: "Para equilibrio y core con peso.", tips: ["Lento y controlado", "Foco en estabilidad", "Cuerpo recto"], errors: ["Prisa", "Desequilibrio"] },
    { cat: "Kettlebells", sub: "T√©cnica", name: "Turkish get-up (parcial)", musc: ["Control"], risk: "Mod", cue: "Ojos en pesa", instr: "Levantamiento turco hasta sentarse o rodilla.", tips: ["Brazo vertical siempre", "Paso a paso", "Mirada arriba"], errors: ["Doblar codo", "Perder vista"] },
    { cat: "Bandas", sub: "Empuje", name: "Press pecho con banda", musc: ["Pecho"], risk: "Bajo", cue: "Pu√±etazo", instr: "Banda en espalda, empuja adelante.", tips: ["Banda en espalda", "Empuja frente", "Control"], errors: ["Roce en brazos", "Hombros arriba"] },
    { cat: "Bandas", sub: "Tracci√≥n", name: "Remo con banda", musc: ["Espalda"], risk: "Bajo", cue: "Codos atr√°s", instr: "Banda en poste, jala hacia ti.", tips: ["Pecho fuera", "Aprieta esc√°pula", "Codos atr√°s"], errors: ["Hombros orejas", "Mu√±ecas dobladas"] },
    { cat: "Bandas", sub: "Hombro", name: "Face pull", musc: ["Postural"], risk: "Bajo", cue: "A la cara", instr: "Jala banda a la frente separando manos.", tips: ["Codos altos", "Rotaci√≥n externa", "Esc√°pulas"], errors: ["Jalar al pecho", "Codos bajos"] },
    { cat: "Bandas", sub: "Hombro", name: "Pull-aparts", musc: ["Esc√°pulas"], risk: "Bajo", cue: "Rompe banda", instr: "Brazos rectos, separa la banda hasta tocar pecho.", tips: ["Brazos rectos", "Toca pecho", "Junta atr√°s"], errors: ["Doblar codos", "Subir hombros"] },
    { cat: "Bandas", sub: "Brazos", name: "Curl con banda", musc: ["B√≠ceps"], risk: "Bajo", cue: "Pisa y jala", instr: "Pisa banda, haz curl de b√≠ceps.", tips: ["Codos fijos", "Rango completo", "Sin inercia"], errors: ["Mover codos", "Mu√±ecas"] },
    { cat: "Bandas", sub: "Brazos", name: "Extensi√≥n de tr√≠ceps", musc: ["Tr√≠ceps"], risk: "Bajo", cue: "Banda arriba", instr: "Banda anclada arriba, extiende brazos abajo.", tips: ["Codos pegados", "Estira abajo", "Solo antebrazo"], errors: ["Abrir codos", "Mover hombros"] },
    { cat: "Bandas", sub: "Pierna", name: "Sentadilla con banda", musc: ["Piernas"], risk: "Bajo", cue: "Pisa fuerte", instr: "Pisa banda, extremos en hombros. Sentadilla.", tips: ["Banda hombros/pies", "Tensi√≥n constante", "Espalda recta"], errors: ["Banda suelta abajo", "Rodillas dentro"] },
    { cat: "Bandas", sub: "Pierna", name: "Zancadas con banda", musc: ["Piernas"], risk: "Mod", cue: "Pisa delante", instr: "Pisa banda con pie delantero. Zancada.", tips: ["Banda pie delantero", "Torso recto", "Equilibrio"], errors: ["Perder balance", "Banda desliza"] },
    { cat: "Bandas", sub: "Gl√∫teo", name: "Abducci√≥n de cadera", musc: ["Gl√∫teo medio"], risk: "Bajo", cue: "Paso lateral", instr: "Banda en tobillos/rodillas. Abre pierna lateral.", tips: ["Rodillas tensan banda", "Culo bajo", "Control"], errors: ["Piernas rectas", "Juntar rodillas"] },
    { cat: "Bandas", sub: "Gl√∫teo", name: "Aducci√≥n de cadera", musc: ["Aductores"], risk: "Bajo", cue: "Cierra", instr: "Banda en poste. Cruza pierna por delante.", tips: ["Banda anclada", "Cruza pierna", "Equilibrio"], errors: ["Girar cadera", "Sin control"] },
    { cat: "Bandas", sub: "Core", name: "Pallof press", musc: ["Anti-rotaci√≥n"], risk: "Bajo", cue: "Quieto", instr: "Press al frente resistiendo giro lateral.", tips: ["Empuja y aguanta", "Pies firmes", "Brazos rectos"], errors: ["Rotar", "Hombros tensos"] },
    { cat: "Bandas", sub: "Core", name: "Woodchoppers", musc: ["Oblicuos"], risk: "Bajo", cue: "Le√±ador", instr: "Giro de torso diagonal de arriba a abajo.", tips: ["Diagonal arriba-abajo", "Gira pie", "Brazos rectos"], errors: ["Solo brazos", "Espalda curva"] },
    { cat: "Bandas", sub: "Asistencia", name: "Asistencia en dominadas", musc: ["Dorsal"], risk: "Bajo", cue: "Pie en bucle", instr: "Usa banda para quitar peso en dominada.", tips: ["Ayuda subir", "Controla bajar", "Pie seguro"], errors: ["Banda escapa", "Golpe en cara"] },
    { cat: "Bandas", sub: "Resistencia", name: "Resistencia en sentadilla", musc: ["Potencia"], risk: "Mod", cue: "Banda tensa", instr: "Banda anclada abajo a√±ade resistencia al subir.", tips: ["Ancla abajo", "Sube explosivo", "Tensi√≥n final"], errors: ["Perder tensi√≥n", "Mala postura"] },
    { cat: "Suspensi√≥n", sub: "Tracci√≥n", name: "Row suspendido", musc: ["Espalda"], risk: "Bajo", cue: "Tabla", instr: "Remo inclinado usando correas.", tips: ["Pecho a anclaje", "Cuerpo recto", "Codos atr√°s"], errors: ["Cadera cae", "Impulso"] },
    { cat: "Suspensi√≥n", sub: "Empuje", name: "Chest press suspendido", musc: ["Pecho"], risk: "Mod", cue: "Cintas arriba", instr: "Flexiones con manos en las correas.", tips: ["Cintas no tocan brazos", "Core activo", "Control"], errors: ["Cintas rozan", "Lumbar cae"] },
    { cat: "Suspensi√≥n", sub: "Pierna", name: "Squat asistido", musc: ["Piernas"], risk: "Bajo", cue: "Si√©ntate atr√°s", instr: "Sentadilla agarrado al TRX para equilibrio.", tips: ["Usa brazos si necesitas", "Profundo", "Espalda recta"], errors: ["Colgarse totalmente", "Rodillas dentro"] },
    { cat: "Suspensi√≥n", sub: "Pierna", name: "Split squat", musc: ["Unilateral"], risk: "Alto", cue: "Pie colgado", instr: "Pie trasero en estribo. Sentadilla a una pierna.", tips: ["Pie en estribo", "Salto opcional", "Estabilidad"], errors: ["Perder equilibrio", "Pie escapa"] },
    { cat: "Suspensi√≥n", sub: "Pierna", name: "Lunge suspendido", musc: ["Piernas"], risk: "Alto", cue: "Rodilla atr√°s", instr: "Zancada atr√°s con pie en estribo.", tips: ["Control total", "Torso recto", "Rodilla estable"], errors: ["Tocar suelo rodilla", "Desequilibrio"] },
    { cat: "Suspensi√≥n", sub: "Empuje", name: "Push-up suspendido", musc: ["Pecho instable"], risk: "Alto", cue: "Tiembla", instr: "Flexi√≥n de pecho con manos en estribos (inestable).", tips: ["Manos en estribos", "Estabiliza", "Core fuerte"], errors: ["Cintas rozan", "Caer de cara"] },
    { cat: "Suspensi√≥n", sub: "Core", name: "Plank suspendido", musc: ["Core"], risk: "Mod", cue: "Pies colgados", instr: "Plancha con pies en los estribos.", tips: ["Cuerpo horizontal", "Codos suelo", "Gl√∫teo duro"], errors: ["Hamaca lumbar", "Pies muy altos"] },
    { cat: "Suspensi√≥n", sub: "Core", name: "Pike suspendido", musc: ["Abs"], risk: "Alto", cue: "V invertida", instr: "Desde plancha, sube cadera al techo con piernas rectas.", tips: ["Sube cadera", "Piernas rectas", "Cabeza entre brazos"], errors: ["Doblar rodillas", "Bajar cadera mucho"] },
    { cat: "Suspensi√≥n", sub: "Isquios", name: "Hamstring curl suspendido", musc: ["Isquios"], risk: "Mod", cue: "Talones al culo", instr: "Tumbado, talones en estribos. Acerca talones a gl√∫teo.", tips: ["Cadera arriba siempre", "Tira fuerte", "Controla vuelta"], errors: ["Bajar cadera", "Calambre"] },
    { cat: "Suspensi√≥n", sub: "Hombro", name: "Y-fly / T-fly", musc: ["Hombro post"], risk: "Mod", cue: "Brazos rectos", instr: "Aperturas en forma de Y o T.", tips: ["Forma Y o T", "Tensi√≥n constante", "Sin doblar codos"], errors: ["Doblar codos", "Cintas flojas"] },
    { cat: "Estabilidad", sub: "Board", name: "Balance board", musc: ["Tobillos"], risk: "Mod", cue: "No toques suelo", instr: "Mant√©n equilibrio sobre tabla inestable.", tips: ["Rodillas flex", "Mirada frente", "Brazos equilibran"], errors: ["Rigidez", "Mirar pies"] },
    { cat: "Estabilidad", sub: "Propio", name: "Equilibrio bipedestaci√≥n", musc: ["Propiocepci√≥n"], risk: "Bajo", cue: "Cig√ºe√±a", instr: "P√°rate sobre un pie.", tips: ["Ojos cerrados dif√≠cil", "Rodilla alta", "Pie activo"], errors: ["Apoyar pie", "Saltitos"] },
    { cat: "Estabilidad", sub: "Propio", name: "Sentadilla controlada", musc: ["Piernas"], risk: "Mod", cue: "Inestable", instr: "Sentadilla sobre Bosu o superficie inestable.", tips: ["Baja lento", "Estabiliza", "Pies planos"], errors: ["Temblar rodillas", "Caerse"] },
    { cat: "Estabilidad", sub: "Propio", name: "Split squat asistido", musc: ["Unilateral"], risk: "Bajo", cue: "Palo escoba", instr: "Split squat con ayuda de un bast√≥n para equilibrio.", tips: ["Ayuda m√≠nima", "T√©cnica perfecta", "Rango completo"], errors: ["Apoyarse mucho", "Torso inclinado"] },
    { cat: "Estabilidad", sub: "Core", name: "Plancha con balance", musc: ["Core"], risk: "Mod", cue: "3 apoyos", instr: "Plancha levantando un brazo o pierna.", tips: ["Levanta mano/pie", "Sin girar", "Cadera fija"], errors: ["Rotar cadera", "Caer"] },
    { cat: "Estabilidad", sub: "Empuje", name: "Push-ups inestables", musc: ["Hombro"], risk: "Mod", cue: "Manos bal√≥n", instr: "Flexiones con manos sobre bal√≥n medicinal.", tips: ["Bal√≥n medicinal/bosu", "Control", "Pecho al bal√≥n"], errors: ["Mu√±ecas dolor", "Resbalar"] },
    { cat: "Estabilidad", sub: "Propio", name: "Transferencias de peso", musc: ["Coordinaci√≥n"], risk: "Bajo", cue: "Cambio peso", instr: "Cambia peso de una pierna a otra con control.", tips: ["Lado a lado fluido", "Control centro", "Suave"], errors: ["Movimiento brusco", "Sin control"] },
    { cat: "Recuperaci√≥n", sub: "Foam", name: "Liberaci√≥n de cu√°driceps", musc: ["Cu√°driceps"], risk: "Bajo", cue: "Amasado", instr: "Rueda rodillo por muslo frontal.", tips: ["Rueda lento", "Apoya antebrazos", "Respira"], errors: ["Muy r√°pido", "Tensar pierna"] },
    { cat: "Recuperaci√≥n", sub: "Foam", name: "Isquiotibiales", musc: ["Isquios"], risk: "Bajo", cue: "Sentado", instr: "Rueda rodillo por parte trasera del muslo.", tips: ["Desde gl√∫teo a rodilla", "Cruza piernas presi√≥n", "Lento"], errors: ["Poco peso", "R√°pido"] },
    { cat: "Recuperaci√≥n", sub: "Foam", name: "Gl√∫teos", musc: ["Gl√∫teos"], risk: "Bajo", cue: "Figura 4", instr: "Si√©ntate sobre rodillo cruzando una pierna.", tips: ["Cruza pierna", "Incl√≠nate al lado", "Busca dolor"], errors: ["No cruzar pierna", "No encontrar punto"] },
    { cat: "Recuperaci√≥n", sub: "Foam", name: "Gemelos", musc: ["Gemelos"], risk: "Bajo", cue: "Bombeo", instr: "Rueda rodillo por pantorrillas.", tips: ["Busca puntos", "Mueve pie", "Presi√≥n"], errors: ["Sin presi√≥n", "Rodilla bloqueada"] },
    { cat: "Recuperaci√≥n", sub: "Foam", name: "Dorsal ancho", musc: ["Dorsal"], risk: "Bajo", cue: "Axila", instr: "De lado, rueda bajo la axila.", tips: ["Brazo estirado", "Rueda costado", "Lento"], errors: ["Sobre costillas flotantes", "Dolor excesivo"] },
    { cat: "Recuperaci√≥n", sub: "Foam", name: "Erectores espinales", musc: ["Espalda"], risk: "Mod", cue: "Tor√°cica", instr: "Rodillo en espalda alta. NO lumbares.", tips: ["Abraza pecho", "Solo espalda alta", "Cadera suelo"], errors: ["Rodar lumbares", "Cabeza colgando"] },
    { cat: "Recuperaci√≥n", sub: "Foam", name: "Movilidad tor√°cica", musc: ["Tor√°cica"], risk: "Bajo", cue: "Extensi√≥n", instr: "Arquea espalda alta sobre rodillo.", tips: ["Foam en om√≥platos", "Arquea atr√°s", "Expira"], errors: ["Arquear lumbar", "Forzar cuello"] },
    { cat: "Recuperaci√≥n", sub: "Bola", name: "Liberaci√≥n plantar", musc: ["Pie"], risk: "Bajo", cue: "Pisa bola", instr: "Pisa pelota de tenis/lacrosse con pie descalzo.", tips: ["Rueda arco pie", "Presiona puntos", "De pie"], errors: ["Resbalar", "Poca presi√≥n"] },
    { cat: "Recuperaci√≥n", sub: "Bola", name: "Gl√∫teo profundo", musc: ["Piriforme"], risk: "Bajo", cue: "Punto gatillo", instr: "Si√©ntate sobre bola en el gl√∫teo.", tips: ["Si√©ntate en bola", "Busca dolor", "Relaja"], errors: ["Hueso sacro", "Tenso"] },
    { cat: "Recuperaci√≥n", sub: "Bola", name: "Piriforme", musc: ["Cadera"], risk: "Bajo", cue: "Ci√°tica", instr: "Bola en lateral del gl√∫teo.", tips: ["Lado gl√∫teo", "Relaja", "Aguanta"], errors: ["Tenso", "Lugar err√≥neo"] },
    { cat: "Recuperaci√≥n", sub: "Bola", name: "Trapecio", musc: ["Cuello"], risk: "Bajo", cue: "Contra pared", instr: "Bola entre trapecio y pared.", tips: ["Bola entre hombro/cuello", "Presiona", "Mueve brazo"], errors: ["Sobre columna", "Cabeza adelante"] },
    { cat: "Recuperaci√≥n", sub: "Bola", name: "Pectoral menor", musc: ["Pecho"], risk: "Bajo", cue: "Hombro anterior", instr: "Bola entre pecho y pared.", tips: ["Bajo clav√≠cula", "Brazo atr√°s", "Presiona"], errors: ["Sobre hueso", "Muy fuerte"] },
    { cat: "Recuperaci√≥n", sub: "Bola", name: "Romboides", musc: ["Esc√°pula"], risk: "Bajo", cue: "Entre paletillas", instr: "Bola entre esc√°pula y columna.", tips: ["Tumbado o pared", "Cruza brazo", "Respira"], errors: ["Columna vertebral", "Costillas"] },
    { cat: "Agarre", sub: "Mano", name: "Hand grip unilateral", musc: ["Antebrazo"], risk: "Bajo", cue: "Aprieta", instr: "Usa pinza de mano.", tips: ["Cierre completo", "Abre lento", "Repeticiones"], errors: ["Medio rango", "Mu√±eca doblada"] },
    { cat: "Agarre", sub: "Isom√©trico", name: "Hand grip isom√©trico", musc: ["Antebrazo"], risk: "Bajo", cue: "Sin soltar", instr: "Cierra la pinza y mant√©n.", tips: ["Mant√©n cerrado", "M√°xima fuerza", "Tiempo"], errors: ["Aflojar", "Temblar"] },
    { cat: "Agarre", sub: "Tempo", name: "Hand grip tempo", musc: ["Antebrazo"], risk: "Bajo", cue: "Lento", instr: "Cierra r√°pido, abre muy lento.", tips: ["1s cierra 3s abre", "Control", "Quema"], errors: ["R√°pido", "Rebote"] },
    { cat: "Agarre", sub: "Carry", name: "Farmer holds", musc: ["Agarre"], risk: "Bajo", cue: "Estatua", instr: "Sost√©n peso pesado a los lados sin moverte.", tips: ["Pesas pesadas", "Hombros atr√°s", "Postura"], errors: ["Hombros ca√≠dos", "Dedos abren"] },
    { cat: "Agarre", sub: "Colgar", name: "Dead hangs", musc: ["Descompresi√≥n"], risk: "Bajo", cue: "Relaja espalda", instr: "Cu√©lgate de una barra pasivamente.", tips: ["Cuelga pasivo", "Respira", "Relaja hombros"], errors: ["Tensi√≥n hombros", "Soltarse de golpe"] },
    { cat: "Agarre", sub: "Colgar", name: "Dead hangs asistidos", musc: ["Agarre"], risk: "Bajo", cue: "Puntillas", instr: "Cuelga con pies tocando suelo para quitar peso.", tips: ["Pies tocan suelo", "Quita peso", "Progresi√≥n"], errors: ["Colgarse todo", "Mala postura"] },
    { cat: "Agarre", sub: "Colgar", name: "Dead hangs con lastre", musc: ["Fuerza"], risk: "Mod", cue: "Peso extra", instr: "Cuelga con peso a√±adido.", tips: ["Cintur√≥n lastre", "Agarre firme", "Seguridad"], errors: ["Resbalar", "Dolor hombro"] },
    { cat: "Agarre", sub: "Dedos", name: "Pinch grip con discos", musc: ["Dedos"], risk: "Bajo", cue: "Pinza", instr: "Sost√©n un disco pellizc√°ndolo con los dedos.", tips: ["Sost√©n disco dedos", "Sin palma", "Aguanta"], errors: ["Usar palma", "Disco resbala"] }
];

const EXERCISES = [{
    version: "3.5.0",
    exercises: RAW_DATA.map(item => {
        let tipo = 'strength';
        if (item.cat === 'Cardio') tipo = 'cardio';
        else if (['Recuperaci√≥n', 'Estabilidad'].includes(item.cat) || item.name.toLowerCase().includes('hold') || item.name.toLowerCase().includes('plank') || item.name.toLowerCase().includes('iso') || item.name.toLowerCase().includes('hang')) tipo = 'duration';
        return {
            id: item.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9]/g, "_"),
            nombre: item.name,
            patron: item.sub,
            categoria: [item.cat],
            tipo_registro: tipo,
            objetivos: ["General"],
            nivel: "General",
            equipo: [item.cat],
            descripcion: `Ejercicio de ${item.cat} (${item.sub}).`,
            musculos: item.musc,
            riesgo: item.risk,
            cue_principal: item.cue,
            favorito: false,
            instr: item.instr || "Realiza el ejercicio manteniendo la t√©cnica adecuada.",
            tips: item.tips || ["Mant√©n la concentraci√≥n", "Controla la respiraci√≥n"],
            errores_comunes: item.errors || ["Perder la postura", "Usar inercia"],
            imagen: "",
            video: ""
        };
    })
}];

let exercises = EXERCISES[0].exercises;
let currentSession = [];
let history = JSON.parse(localStorage.getItem('hr-history') || '[]');

function init() {
    populateFilters();
    applyFilters();
    updateApiKeyUI();
    document.querySelectorAll('.filter-select').forEach(s => s.addEventListener('change', applyFilters));
}

window.handleSearchInput = function() {
    const val = document.getElementById('search').value;
    const clearBtn = document.getElementById('clear-search');
    if (val.length > 0) clearBtn.classList.add('visible'); else clearBtn.classList.remove('visible');
    applyFilters();
}

window.clearSearch = function() {
    const input = document.getElementById('search');
    input.value = '';
    window.handleSearchInput();
    input.focus();
}

window.forceShowAll = function() {
    const input = document.getElementById('search');
    input.value = '***';
    window.handleSearchInput();
}

function getUniqueValues(key, isArray = false) {
    const values = new Set();
    exercises.forEach(ex => {
        const val = ex[key];
        if (isArray && Array.isArray(val)) val.forEach(v => values.add(v)); else if (val) values.add(val);
    });
    return [...values].sort();
}

function populateFilters() {
    const filters = [{ id: 'filter-category', key: 'categoria', isArray: true }, { id: 'filter-pattern', key: 'patron', isArray: false }, { id: 'filter-muscle', key: 'musculos', isArray: true }, { id: 'filter-risk', key: 'riesgo', isArray: false }, { id: 'filter-equipment', key: 'equipo', isArray: true }];
    filters.forEach(f => {
        const select = document.getElementById(f.id);
        const label = select.options[0].textContent;
        select.innerHTML = `<option value="">${label}</option>`;
        getUniqueValues(f.key, f.isArray).forEach(v => {
            const opt = document.createElement('option');
            opt.value = v; opt.textContent = v; select.appendChild(opt);
        });
    });
}

function applyFilters() {
    const search = document.getElementById('search').value.toLowerCase();
    const cat = document.getElementById('filter-category').value;
    const pat = document.getElementById('filter-pattern').value;
    const musc = document.getElementById('filter-muscle').value;
    const risk = document.getElementById('filter-risk').value;
    const eq = document.getElementById('filter-equipment').value;

    const hasFilters = cat || pat || musc || risk || eq;
    document.getElementById('filter-badge').className = hasFilters ? 'filter-badge active' : 'filter-badge';

    // Funci√≥n *** conservada
    if (search === '***') {
        renderExercises(exercises);
        return;
    }

    if (!search && !hasFilters) {
        renderWelcomeState();
        return;
    }

    const filtered = exercises.filter(ex => {
        const matchesSearch = ex.nombre.toLowerCase().includes(search) || (ex.musculos && ex.musculos.some(m => m.toLowerCase().includes(search))) || (ex.patron && ex.patron.toLowerCase().includes(search));
        const matchesCat = !cat || ex.categoria.includes(cat);
        const matchesPat = !pat || ex.patron === pat;
        const matchesMusc = !musc || ex.musculos.includes(musc);
        const matchesRisk = !risk || ex.riesgo === risk;
        const matchesEq = !eq || ex.equipo.includes(eq);
        return matchesSearch && matchesCat && matchesPat && matchesMusc && matchesRisk && matchesEq;
    });
    renderExercises(filtered);
}

window.toggleFilterPanel = function() { document.getElementById('filter-panel').classList.toggle('visible'); }

window.resetFilters = function() {
    document.getElementById('search').value = '';
    window.handleSearchInput();
    document.querySelectorAll('.filter-select').forEach(s => s.value = '');
    applyFilters();
}

function renderWelcomeState() {
    const el = document.getElementById('exercise-list');
    el.innerHTML = `
        <div class="loader-container">
            <div style="font-size:40px; margin-bottom:10px">üèãÔ∏è</div>
            <p style="margin-bottom:16px;">Busca un ejercicio o selecciona un filtro.</p>
            <button class="secondary" onclick="window.forceShowAll()" style="width:100%">Mostrar todos los ejercicios</button>
        </div>
    `;
}

function renderExercises(list) {
    const el = document.getElementById('exercise-list');
    el.innerHTML = '';
    if (list.length === 0) { el.innerHTML = `<div class="loader-container"><p>Sin resultados</p></div>`; return; }
    list.forEach(ex => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div class="exercise-title">${ex.nombre}</div>
            <div class="badges">
                <span class="badge accent">${ex.patron}</span>
                <span class="badge risk-${ex.riesgo}">${ex.riesgo}</span>
            </div>
            <div class="exercise-actions">
                <button class="primary" onclick='window.addExercise("${ex.id}")'>A√±adir</button>
                <button class="secondary" onclick='window.openInfoModal("${ex.id}")'>Ver Info</button>
            </div>
        `;
        el.appendChild(div);
    });
}

window.openInfoModal = async function(id) {
    const ex = exercises.find(e => e.id === id);
    if (!ex) return;
    const modal = document.getElementById('info-modal');
    const staticContainer = document.getElementById('static-info-container');
    const aiImagesContainer = document.getElementById('ai-images-container');
    document.getElementById('info-modal-title').textContent = ex.nombre;
    staticContainer.innerHTML = `
        ${ex.cue_principal ? `<div class="cue-box">üí° "${ex.cue_principal}"</div>` : ''}
        <span class="detail-label">Instrucciones</span>
        <div class="detail-text">${ex.instr}</div>
        <span class="detail-label">M√∫sculos</span>
        <div class="detail-text">${ex.musculos.join(", ")}</div>
        <button class="secondary" onclick='window.youtube("${ex.nombre}")' style="width:100%; margin-top:10px">üì∫ Buscar T√©cnica en YouTube</button>
    `;
    modal.classList.add('visible');
    aiImagesContainer.innerHTML = `
        <div style="display:flex; gap:10px; flex-direction:column">
            <button class="primary" onclick="window.generateVisuals('${ex.id}')">‚ú® Generar Imagen (IA)</button>
            <button class="secondary" onclick="window.openGoogleImages('${ex.id}')">üåê Google Im√°genes</button>
        </div>
    `;
    const textHeader = document.getElementById('ai-text-header');
    textHeader.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center; width:100%">
            <span>An√°lisis IA</span>
            <button onclick="window.refreshAiAnalysis('${id}')" style="background:none; border:none; font-size:16px; color:var(--primary); padding:0">‚Üª</button>
        </div>
    `;
    window.fetchAiTextAnalysis(id);
}

window.refreshAiAnalysis = function(id) { delete textAnalysisCache[id]; window.fetchAiTextAnalysis(id); }

window.fetchAiTextAnalysis = async function(id, isSilent = false) {
    const container = document.getElementById('ai-text-container');
    const ex = exercises.find(e => e.id === id);
    if (!ex) return null;
    
    if (textAnalysisCache[id]) { 
        if(!isSilent) container.innerHTML = `<div style="font-size:14px; line-height:1.6; color:#ddd;">${textAnalysisCache[id]}</div>`; 
        return textAnalysisCache[id]; 
    }
    
    if(!isSilent) container.innerHTML = '<div class="loader-container"><div class="loader"></div></div>';
    
    const ai = await getGenAI();
    if (!ai) { 
        if(!isSilent) container.innerHTML = '<p style="font-size:13px; text-align:center; color:var(--text-secondary)">Configura tu API Key en Ajustes.</p>'; 
        return null; 
    }
    
    const textPrompt = `Act as an expert biomechanics coach. Technical analysis for: "${ex.nombre}". Output HTML (no markdown) in Spanish: <h4>üéØ Objetivo</h4>, <h4>üîë Cues</h4>, <h4>‚ö†Ô∏è Errores</h4>, <h4>üî• Sensaciones</h4>, <h4>‚è±Ô∏è Tempo</h4>, <h4>ü§∏ Movilidad</h4>, <h4>‚öôÔ∏è Biomec√°nica y Respiraci√≥n</h4>. Use <b> for orange highlights.`;
    
    try {
        const response = await ai.models.generateContent({ model: 'gemini-3-flash-preview', contents: textPrompt });
        const text = response.text;
        textAnalysisCache[id] = text;
        if(!isSilent) container.innerHTML = `<div style="font-size:14px; line-height:1.6; color:#ddd;">${text}</div>`;
        return text;
    } catch (e) { 
        if(!isSilent) container.innerHTML = `<p style="color:var(--risk-high); font-size:12px; text-align:center">Error IA.</p>`; 
        return null;
    }
}

window.generateVisuals = async function(id) {
    const ex = exercises.find(e => e.id === id);
    if (!ex) return;
    const aiImagesContainer = document.getElementById('ai-images-container');
    
    // 1. Asegurar que tenemos el an√°lisis t√©cnico para el contexto
    let analysis = textAnalysisCache[id];
    if (!analysis) {
        aiImagesContainer.innerHTML = '<div class="loader-container"><div class="loader"></div> Analizando t√©cnica para la imagen...</div>';
        analysis = await window.fetchAiTextAnalysis(id, true);
    }

    aiImagesContainer.innerHTML = '<div class="loader-container"><div class="loader"></div> Generando visual t√©cnico...</div>';
    const ai = await getGenAI();
    if (!ai) { aiImagesContainer.innerHTML = '<p style="font-size:12px; text-align:center">API Key requerida.</p>'; return; }

    // 2. Limpiar HTML del an√°lisis para el prompt
    const cleanAnalysis = analysis ? analysis.replace(/<[^>]*>?/gm, ' ') : '';
    
    const imgPrompt = `Professional photorealistic fitness photography of exercise: ${ex.nombre}. 
    TECHNICAL CONTEXT: ${cleanAnalysis.substring(0, 500)}.
    Visual instructions: Show clear body mechanics, correct posture, and joint alignments. Neutral gym background, dramatic lighting emphasizing muscle engagement. Full body view.`;

    try {
        const response = await ai.models.generateContent({ model: 'gemini-2.5-flash-image', contents: { parts: [{ text: imgPrompt }] } });
        let imageUrl = null;
        if (response.candidates && response.candidates[0].content.parts) {
            for (const part of response.candidates[0].content.parts) { if (part.inlineData) imageUrl = `data:image/png;base64,${part.inlineData.data}`; }
        }
        if(imageUrl) aiImagesContainer.innerHTML = `<img src="${imageUrl}" style="width:100%; border-radius:12px; margin-top:10px" alt="${ex.nombre}" />`;
        else throw new Error();
    } catch (e) {
        aiImagesContainer.innerHTML = `<p style="color:var(--risk-high); font-size:12px; margin-bottom:10px">L√≠mite alcanzado.</p>
        <button class="secondary" style="width:100%" onclick="window.openGoogleImages('${ex.id}')">üåê Buscar en Google</button>`;
    }
}

window.openGoogleImages = function(id) {
    const ex = exercises.find(e => e.id === id);
    if (ex) window.open(`https://www.google.com/search?tbm=isch&q=${encodeURIComponent(ex.nombre + " t√©cnica gym")}`, '_blank');
}

window.closeInfoModal = function() {
    document.getElementById('info-modal').classList.remove('visible');
    setTimeout(() => {
        document.getElementById('ai-images-container').innerHTML = '';
        document.getElementById('ai-text-container').innerHTML = '';
        document.getElementById('static-info-container').innerHTML = '';
    }, 200);
}

window.youtube = function(name) { window.open(`https://www.youtube.com/results?search_query=t√©cnica ${encodeURIComponent(name)}`, '_blank'); }

window.addExercise = function(id) {
    const exData = exercises.find(e => e.id === id);
    currentSession.push({ nombre: exData.nombre, type: exData.tipo_registro, series: [] });
    alert('A√±adido a la sesi√≥n');
}

window.renderSession = function() {
    const el = document.getElementById('session'); el.innerHTML = '';
    if (currentSession.length === 0) { el.innerHTML = '<div class="loader-container"><p>No has a√±adido ejercicios.</p></div>'; return; }
    currentSession.forEach((ex, i) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <div class="exercise-title" style="margin:0">${ex.nombre}</div>
                <button style="background:none; color:var(--risk-high); padding:0; font-size:20px;" onclick="window.removeSessionItem(${i})">‚úï</button>
            </div>
            <div id="sets-${i}"></div>
            <button class="secondary" onclick="window.addSet(${i})" style="width:100%; margin-top:15px; font-size:13px">+ A√±adir Serie</button>
        `;
        el.appendChild(div);
        renderSets(i);
    });
}

window.removeSessionItem = function(index) { if(confirm('¬øEliminar?')) { currentSession.splice(index, 1); window.renderSession(); } }

window.addSet = function(i) {
    const ex = currentSession[i];
    const prevSet = ex.series.length > 0 ? ex.series[ex.series.length - 1] : null;
    let newSet = prevSet ? { ...prevSet } : (ex.type === 'cardio' ? { tiempo: 0, nivel: 0 } : (ex.type === 'duration' ? { tiempo: 0 } : { reps: 0, peso: 0 }));
    currentSession[i].series.push(newSet);
    renderSets(i);
}

function renderSets(i) {
    const el = document.getElementById(`sets-${i}`); const ex = currentSession[i]; el.innerHTML = '';
    ex.series.forEach((s, j) => {
        let inputsHtml = ex.type === 'cardio' ? 
            `<div class="set-input-group"><label>Min</label><input type="number" value="${s.tiempo}" onchange="window.updateSet(${i},${j},'tiempo',this.value)"></div><div class="set-input-group"><label>Lvl</label><input type="number" value="${s.nivel}" onchange="window.updateSet(${i},${j},'nivel',this.value)"></div>` :
            (ex.type === 'duration' ? `<div class="set-input-group"><label>Seg</label><input type="number" value="${s.tiempo}" onchange="window.updateSet(${i},${j},'tiempo',this.value)"></div>` :
            `<div class="set-input-group"><label>Reps</label><input type="number" value="${s.reps}" onchange="window.updateSet(${i},${j},'reps',this.value)"></div><div class="set-input-group"><label>Kg</label><input type="number" value="${s.peso}" onchange="window.updateSet(${i},${j},'peso',this.value)"></div>`);
        el.innerHTML += `<div class="set-row"><span style="font-size:12px; color:var(--text-secondary); width:20px;">${j+1}</span>${inputsHtml}</div>`;
    });
}

window.updateSet = function(i, j, key, val) { currentSession[i].series[j][key] = Number(val); }

window.saveSession = function() {
    if (currentSession.length === 0) return alert('Vac√≠o');
    if (!confirm('¬øGuardar sesi√≥n?')) return;
    history.push({ id: Date.now(), fecha: new Date().toISOString(), ejercicios: currentSession });
    localStorage.setItem('hr-history', JSON.stringify(history));
    currentSession = [];
    window.switchTab('history', document.querySelectorAll('.nav-item')[2]);
    alert('¬°Guardada!');
}

window.renderHistory = function() {
    const el = document.getElementById('history'); el.innerHTML = '';
    if (history.length === 0) { el.innerHTML = '<div class="loader-container"><p>Sin historial</p></div>'; return; }
    history.slice().reverse().forEach(h => {
        const div = document.createElement('div'); div.className = 'card history-card';
        div.onclick = (e) => div.querySelector('.history-details').classList.toggle('visible');
        const d = new Date(h.fecha);
        div.innerHTML = `
            <div class="history-date">${d.toLocaleDateString()} ${d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
            <div class="history-summary">${h.ejercicios.length} ejercicios</div>
            <div class="history-details">${h.ejercicios.map(ex => `<div class="hist-ex-item"><div class="hist-ex-name">${ex.nombre}</div>${ex.series.map(s => `<span class="hist-set-badge">${ex.type === 'cardio' ? s.tiempo+'m L'+s.nivel : (ex.type === 'duration' ? s.tiempo+'s' : s.reps+'x'+s.peso+'k')}</span>`).join('')}</div>`).join('')}</div>
        `;
        el.appendChild(div);
    });
}

window.exportData = function() {
    const blob = new Blob([JSON.stringify(history, null, 2)], { type: 'application/json' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
    a.download = `backup-${new Date().toISOString().slice(0,10)}.json`; a.click();
}

window.importData = function(e) {
    const file = e.target.files[0]; if (!file) return;
    const reader = new FileReader();
    reader.onload = function() {
        try {
            const data = JSON.parse(reader.result);
            if (confirm(`¬øImportar ${data.length} sesiones?`)) { history = data; localStorage.setItem('hr-history', JSON.stringify(history)); window.renderHistory(); }
        } catch (err) { alert('Error JSON'); }
    }
    reader.readAsText(file);
}

init();
</script>
</body>
</html>